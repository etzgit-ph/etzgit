# Saved Prompts

This file contains the previous implementation prompts for reference and tracking.

---
<details>
<summary>Prompts 001â€“030</summary>

```
[- ID: "001"
  Title: "Initialize Git Monorepo with Secure Branch Protection"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Secure Baseline"
    Size: "Small"
    Tags:
      - "git"
      - "security"
      - "governance"
  Description: "Set up the repository as a pnpm monorepo with a 'main' branch protected by required status checks and mandatory PR reviews."
  Implementation_Details:
    Action: "Initialize a new Git repository. Create a 'pnpm-workspace.yaml' file to define the monorepo structure. Configure GitHub's 'main' branch protection rule to require a pull request, at least one approval, and passing status checks (to be defined later)."
    Expected_Artifacts:
      - File: "pnpm-workspace.yaml"
        State: "created"
      - File: ".git/config"
        State: "modified"
    Dependencies:
      - Name: "pnpm"
        Version: "latest"
        Type: "dev"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify pnpm is initialized and the workspace file is correct."
      Instructions: "Run 'pnpm install' in the root. Verify attempting a direct push to 'main' fails due to branch protection."
  Security_Controls:
    - Control: "Protected Branch Enforcement (PR-Only)"
      Description: "Ensures no code bypasses the CI/CD pipeline, security scans, or human-in-the-loop governance."
      Verification: "Review GitHub repository settings for the 'main' branch protection rules."
  Rationale: "This establishes the fundamental governance principle: all agent code changes must pass through an auditable, human-supervised Pull Request process."
  Prerequisites: []

- ID: "002"
  Title: "Configure Root TypeScript Compiler (TSConfig)"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Quality & Consistency"
    Size: "Small"
    Tags:
      - "typescript"
      - "config"
      - "quality"
  Description: "Create the root 'tsconfig.json' with strict type-checking and compiler options, enabling isolated modules."
  Implementation_Details:
    Action: "Create a root 'tsconfig.json' file using the recommended settings for a Node.js monorepo. Enforce 'strict: true', 'forceConsistentCasingInFileNames: true', and 'isolatedModules: true'."
    Expected_Artifacts:
      - File: "tsconfig.json"
        State: "created"
    Dependencies:
      - Name: "typescript"
        Version: "5.x"
        Type: "dev"
  Validation_Criteria:
    - Type: "Syntax"
      Description: "Verify the configuration file loads without errors."
      Command: "tsc --init --noEmit"
    - Type: "Functional_Check"
      Description: "Confirm that a new, intentionally untyped variable in an index file causes a compilation error."
      Instructions: "Create a test file and verify strict mode is active."
  Security_Controls:
    - Control: "Strict Typing and Isolated Modules"
      Description: "Mitigates runtime errors and supports faster, safer refactoring during autonomous upgrades."
      Verification: "Review 'tsconfig.json' for 'strict: true' and 'isolatedModules: true'."
  Rationale: "Strict TypeScript is crucial for an autonomous agent, as it reduces the surface area for logic bugs and ensures code generated by Copilot adheres to defined types."
  Prerequisites: ["001"]

- ID: "003"
  Title: "Define Shared ESLint and Prettier Configuration"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Quality & Consistency"
    Size: "Medium"
    Tags:
      - "linting"
      - "security"
      - "quality"
  Description: "Set up shared ESLint and Prettier configurations with essential security plugins to enforce code style and catch vulnerabilities early."
  Implementation_Details:
    Action: "Install ESLint, Prettier, and relevant plugins (e.g., 'eslint-plugin-security', '@typescript-eslint/eslint-plugin'). Create the root '.eslintrc.js' and '.prettierrc.js' files, configuring rules for security, style, and type-aware linting."
    Expected_Artifacts:
      - File: ".eslintrc.js"
        State: "created"
      - File: ".prettierrc.js"
        State: "created"
      - File: "package.json"
        State: "modified"
    Dependencies:
      - Name: "eslint"
        Version: "latest"
        Type: "dev"
      - Name: "prettier"
        Version: "latest"
        Type: "dev"
      - Name: "eslint-plugin-security"
        Version: "latest"
        Type: "dev"
  Validation_Criteria:
    - Type: "Syntax"
      Description: "Run a dry-run lint and format check."
      Command: "pnpm exec eslint ."
    - Type: "Functional_Check"
      Description: "Verify the security plugin flags an obvious vulnerability, such as an insecure regex or process.env usage."
      Instructions: "Temporarily insert a test case that should fail the security linting check and run the linter."
  Security_Controls:
    - Control: "SAST via Linting (Immediate Feedback)"
      Description: "Catches common security flaws like hardcoded secrets, insecure functions, and buffer overflows before code is committed."
      Verification: "Check '.eslintrc.js' for 'plugin:security/recommended' rule."
  Rationale: "Enforcing static analysis at the pre-commit stage prevents the Agent from committing self-introduced vulnerabilities during an autonomous upgrade cycle."
  Prerequisites: ["002"]

- ID: "004"
  Title: "Configure .editorconfig for Code Consistency"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Quality & Consistency"
    Size: "Small"
    Tags:
      - "config"
      - "quality"
  Description: "Create a root '.editorconfig' file to ensure consistent indentation, line endings, and character sets across all files, regardless of the editor used."
  Implementation_Details:
    Action: "Create the root '.editorconfig' file, specifying consistent settings for 'indent_style', 'indent_size', 'charset', and 'end_of_line' for all relevant file types."
    Expected_Artifacts:
      - File: ".editorconfig"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify indentation is consistent."
      Instructions: "Open an existing configuration file in Codespaces and confirm it adheres to the defined tab/space settings."
  Security_Controls:
    - Control: "N/A"
      Description: "Maintainability control; not a direct security control."
      Verification: "N/A"
  Rationale: "Consistency in formatting is essential for an autonomous agent. It minimizes unnecessary formatting noise in diffs, making generated code patches cleaner and easier for the human reviewer to audit."
  Prerequisites: ["003"]

- ID: "005"
  Title: "Initialize .devcontainer for Codespaces Environment"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Secure Baseline"
    Size: "Medium"
    Tags:
      - "codespaces"
      - "devcontainer"
      - "dx"
  Description: "Create the '.devcontainer/devcontainer.json' to define a reproducible, secure Node.js 20+ environment with all necessary tools (Git, GitHub CLI, Docker CLI, Copilot Agent)."
  Implementation_Details:
    Action: "Create the '.devcontainer' directory and place a 'devcontainer.json' file within it. Specify the use of a secure Node.js 20+ base image, install the GitHub CLI and Docker CLI, and recommend the Copilot extension."
    Expected_Artifacts:
      - File: ".devcontainer/devcontainer.json"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the environment launches correctly with all tools available."
      Instructions: "Rebuild the Codespace and run 'node -v', 'gh --version', and 'docker --version' in the terminal."
  Security_Controls:
    - Control: "Reproducible Environment Security"
      Description: "Isolates the development sandbox to prevent environment drift and ensure that the agent's code runs securely in a known state."
      Verification: "Review 'devcontainer.json' for the use of a specific, secure base image tag (e.g., 'mcr.microsoft.com/devcontainers/typescript-node:20')."
  Rationale: "Codespaces is the core sandbox. This file ensures every developer (human or autonomous) works in the exact same environment, which is critical for agent reliability."
  Prerequisites: ["004"]

- ID: "006"
  Title: "Integrate Husky and lint-staged for Pre-Commit Security"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Pre-Commit Security"
    Size: "Medium"
    Tags:
      - "security"
      - "automation"
      - "hooks"
  Description: "Install and configure Husky and lint-staged to run ESLint, Prettier, and 'pnpm audit' on staged files before a commit is created."
  Implementation_Details:
    Action: "Install 'husky' and 'lint-staged' as dev dependencies. Configure 'package.json' to define the 'pre-commit' hook that runs 'lint-staged'. Configure 'lint-staged' to execute 'eslint --fix', 'prettier --write', and a 'pnpm audit' check on staged files."
    Expected_Artifacts:
      - File: "package.json"
        State: "modified"
      - File: ".husky/pre-commit"
        State: "created"
    Dependencies:
      - Name: "husky"
        Version: "latest"
        Type: "dev"
      - Name: "lint-staged"
        Version: "latest"
        Type: "dev"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify commit fails if a staged file has a lint error or an audit vulnerability."
      Instructions: "Stage a file with a deliberate lint error and attempt to commit. Verify the pre-commit hook auto-fixes/flags the issue."
  Security_Controls:
    - Control: "Local Vulnerability/Quality Gate"
      Description: "Prevents the autonomous agent from accidentally committing code that fails security or quality standards, ensuring PRs start from a clean baseline."
      Verification: "Review the '.husky/pre-commit' script and 'lint-staged' config in 'package.json'."
  Rationale: "This is a non-negotiable step in DevSecOps, especially when dealing with AI-generated code, ensuring immediate feedback on security and quality."
  Prerequisites: ["003", "004"]

- ID: "007"
  Title: "Generate SECURITY.md with Vulnerability Disclosure Policy"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Project Governance"
    Size: "Small"
    Tags:
      - "security"
      - "governance"
      - "documentation"
  Description: "Create a 'SECURITY.md' file detailing the project's policy for reporting vulnerabilities, per industry best practices."
  Implementation_Details:
    Action: "Create the 'SECURITY.md' file in the root directory. Document the preferred method for reporting security issues (e.g., private GitHub security advisories), a policy for response time, and scope."
    Expected_Artifacts:
      - File: "SECURITY.md"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the file is present and accessible."
      Instructions: "View the file in the GitHub repository's 'Security' tab."
  Security_Controls:
    - Control: "Vulnerability Disclosure"
      Description: "Formalizes the process for external researchers to safely report flaws, protecting the integrity of the autonomous agent."
      Verification: "Review the file content to ensure it specifies a private reporting mechanism."
  Rationale: "Standard security governance documentation is mandatory for a production-grade system, ensuring responsible vulnerability management."
  Prerequisites: ["001"]

- ID: "008"
  Title: "Generate Initial Architecture Decision Record (ADR 001)"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Project Governance"
    Size: "Small"
    Tags:
      - "architecture"
      - "documentation"
      - "governance"
  Description: "Document the foundational architectural choice: 'Autonomous Code Agent (ACA) as a NestJS Monoservice on GitHub-Native Infrastructure'."
  Implementation_Details:
    Action: "Create a 'docs/adr/0001-architecture-decision.md' file. Document the context, decision, consequences, and rationale for choosing the NestJS + GitHub-Native stack."
    Expected_Artifacts:
      - File: "docs/adr/0001-architecture-decision.md"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the ADR is correctly formatted and accurately reflects the Phase 0 decisions."
      Instructions: "Review the document's content for completeness."
  Security_Controls:
    - Control: "Architectural Documentation"
      Description: "Provides an auditable trail of high-level decisions, which is critical for human oversight of an autonomous system's evolution."
      Verification: "N/A"
  Rationale: "ADRs are essential for the human governance authority to understand and review the fundamental design choices of the self-iterating agent."
  Prerequisites: ["001"]

- ID: "009"
  Title: "Define Core Agent Directory Structure"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Secure Baseline"
    Size: "Medium"
    Tags:
      - "structure"
      - "monorepo"
      - "nest-js"
  Description: "Scaffold the core monorepo structure: an 'api' NestJS app for the agent and a 'config' package for shared settings."
  Implementation_Details:
    Action: "Create the following directory structure: 'apps/api' (for the NestJS Agent), 'packages/config' (for shared configs like tsconfig overrides). Update 'pnpm-workspace.yaml' to include these workspaces."
    Expected_Artifacts:
      - File: "apps/api/package.json"
        State: "created"
      - File: "packages/config/package.json"
        State: "created"
      - File: "pnpm-workspace.yaml"
        State: "modified"
    Dependencies:
      - Name: "@nestjs/core"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the workspaces are recognized by pnpm."
      Command: "pnpm recursive install"
  Security_Controls:
    - Control: "Decoupled Architecture"
      Description: "Enforces modularity, making it easier to isolate the agent's core logic and restrict its access scope (e.g., to only the 'apps/api' directory)."
      Verification: "Review the directory structure and 'pnpm-workspace.yaml'."
  Rationale: "A clean, domain-driven structure is vital for both human maintainability and the ACA's ability to safely navigate and modify its own codebase."
  Prerequisites: ["009"]

- ID: "010"
  Title: "Create Initial STRIDE Threat Model Documentation (Agent Core)"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Threat Modeling"
    Size: "Large"
    Tags:
      - "security"
      - "threat-modeling"
      - "governance"
  Description: "Generate initial STRIDE threat model documentation focused on the core agent and its ability to self-modify via the GitHub API."
  Implementation_Details:
    Action: "Create 'docs/threat-model.md'. Model the threat surface around the Agent's execution flow (GitHub Action -> Agent Run -> Octokit interaction -> PR creation). Focus on the STRIDE elements: Spoofing (of the Agent identity), Tampering (of the code patch), Repudiation (of the change origin), Information Disclosure (of secrets), Denial of Service (resource exhaustion), and Elevation of Privilege (PAT scope creep)."
    Expected_Artifacts:
      - File: "docs/threat-model.md"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the model explicitly lists at least one mitigation for each STRIDE category relevant to the agent's function."
      Instructions: "Review the document for completeness and adherence to the STRIDE framework."
  Security_Controls:
    - Control: "Proactive Security Analysis (STRIDE)"
      Description: "Forces an analysis of potential attack vectors related to the agent's autonomous capabilities, guiding the implementation of critical security controls."
      Verification: "N/A"
  Rationale: "Threat modeling is a mandatory SSDLC step, especially for a self-modifying system, to ensure security is truly designed-in."
  Prerequisites: ["008"]

- ID: "011"
  Title: "Configure Root pnpm install Script for Audit"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Pre-Commit Security"
    Size: "Small"
    Tags:
      - "security"
      - "npm-audit"
      - "governance"
  Description: "Modify the root 'package.json' to ensure a vulnerability check ('pnpm audit --audit-level critical') is run automatically after every 'pnpm install' and 'pnpm update'."
  Implementation_Details:
    Action: "Update the root 'package.json' with a 'postinstall' script that executes 'pnpm audit --audit-level critical --json | grep -q 'vulnerabilities' || exit 0' to fail if critical vulnerabilities are found, enforcing zero-vulnerability dependencies from the start."
    Expected_Artifacts:
      - File: "package.json"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the postinstall script runs and enforces a critical-level check."
      Command: "pnpm install --force"
  Security_Controls:
    - Control: "Automated Dependency Vulnerability Scanning"
      Description: "Immediately identifies and flags known vulnerabilities upon dependency installation or upgrade, preventing vulnerable packages from entering the agent's codebase."
      Verification: "Review the 'postinstall' script in 'package.json'."
  Rationale: "Given the agent will autonomously upgrade packages, the human oversight team needs assurance that every installation starts from a clean, audited baseline."
  Prerequisites: ["006"]

- ID: "012"
  Title: "Initialize Agent App (apps/api) with NestJS and TSConfig"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Secure Baseline"
    Size: "Medium"
    Tags:
      - "typescript"
      - "nest-js"
      - "config"
  Description: "Scaffold the basic 'apps/api' NestJS application, including its dedicated 'tsconfig.app.json' that extends the root config."
  Implementation_Details:
    Action: "Use the Nest CLI to create a new application in 'apps/api' (or manually scaffold). Create 'apps/api/tsconfig.app.json' to inherit the strict root settings and add application-specific compiler options. Create a minimal 'main.ts' entry point."
    Expected_Artifacts:
      - File: "apps/api/tsconfig.app.json"
        State: "created"
      - File: "apps/api/src/main.ts"
        State: "created"
      - File: "apps/api/package.json"
        State: "modified"
    Dependencies:
      - Name: "@nestjs/platform-express"
        Version: "latest"
        Type: "prod"
      - Name: "reflect-metadata"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Syntax"
      Description: "Verify the application can compile successfully."
      Command: "pnpm run --filter api build"
    - Type: "Functional_Check"
      Description: "Verify the NestJS CLI can run the application (even if it does nothing yet)."
      Command: "pnpm run --filter api start:dev"
  Security_Controls:
    - Control: "Consistent Typing and Modularity"
      Description: "Leverages NestJS's opinionated structure to enforce best practices and reduce complexity for autonomous code modification."
      Verification: "Review 'apps/api/tsconfig.app.json' for 'extends: ../../tsconfig.json'."
  Rationale: "This establishes the core runtime environment for the autonomous agent's logic."
  Prerequisites: ["009", "002"]

- ID: "013"
  Title: "Define Root README.md with Setup Instructions"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Project Governance"
    Size: "Medium"
    Tags:
      - "documentation"
      - "dx"
      - "codespaces"
  Description: "Create the root 'README.md' to guide the human governance team, focusing on Codespaces setup, the human-in-the-loop governance model, and core agent functionality."
  Implementation_Details:
    Action: "Create the root 'README.md'. Include sections for 'Quick Start (Codespaces)', 'Architecture Summary', 'Governance Model (PR-Only)', and 'How to Audit the Agent's Changes'. Add the Project Title and Summary."
    Expected_Artifacts:
      - File: "README.md"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the instructions are accurate for a new Codespaces user."
      Instructions: "Follow the 'Quick Start' section to ensure successful environment setup."
  Security_Controls:
    - Control: "Human-in-the-Loop Documentation"
      Description: "Crucial for the governance authority to quickly understand and securely operate the system."
      Verification: "Ensure the 'Governance Model' is clearly documented."
  Rationale: "Good documentation is the first line of defense against operational errors and misuse, especially for a complex, autonomous system."
  Prerequisites: ["001"]

- ID: "014"
  Title: "Create CONTRIBUTING.md for Developer Governance"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Project Governance"
    Size: "Small"
    Tags:
      - "documentation"
      - "governance"
      - "pr"
  Description: "Generate a 'CONTRIBUTING.md' file outlining the strict PR-based workflow, required code reviews, and the process for overriding/disabling the autonomous agent."
  Implementation_Details:
    Action: "Create the 'CONTRIBUTING.md' file. Emphasize that all human contributions *and* autonomous agent PRs must follow the same process: branch, commit, wait for CI/CD checks, and require human approval before merging to 'main'."
    Expected_Artifacts:
      - File: "CONTRIBUTING.md"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the document explicitly states the PR approval requirement."
      Instructions: "Review the document's content."
  Security_Controls:
    - Control: "Formalized Change Control"
      Description: "Reinforces the human-in-the-loop principle, ensuring every modification to the agent or its governance is peer-reviewed."
      Verification: "N/A"
  Rationale: "Formalizing the contribution process is key to maintaining project health and security across both human and AI-driven development."
  Prerequisites: ["007"]

- ID: "015"
  Title: "Configure Shared Config Package for Root TSConfig Exports"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Quality & Consistency"
    Size: "Small"
    Tags:
      - "typescript"
      - "monorepo"
      - "config"
  Description: "Refactor the root 'tsconfig.json' and place a stripped-down, reusable base into 'packages/config', allowing other workspaces to extend it easily."
  Implementation_Details:
    Action: "Move the core compiler options from the root 'tsconfig.json' into a new file 'packages/config/tsconfig.base.json'. Modify the root 'tsconfig.json' and 'apps/api/tsconfig.app.json' to extend this new base configuration."
    Expected_Artifacts:
      - File: "packages/config/tsconfig.base.json"
        State: "created"
      - File: "tsconfig.json"
        State: "modified"
      - File: "apps/api/tsconfig.app.json"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Syntax"
      Description: "Verify all configurations still compile without errors."
      Command: "pnpm run --filter api build"
  Security_Controls:
    - Control: "Configuration Standardization"
      Description: "Ensures all modules, including future ones autonomously generated by the agent, automatically inherit the same strict security and quality settings."
      Verification: "Review the 'extends' field in the workspace tsconfigs."
  Rationale: "DRY principle applied to configuration. Essential for maintainability and scalability in a monorepo."
  Prerequisites: ["009", "002", "012"]
- ID: "016"
  Title: "Initialize Initial Version Control Tags and Version File"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Project Governance"
    Size: "Small"
    Tags:
      - "versioning"
      - "governance"
      - "automation"
  Description: "Define the initial version of the project and create a version file that can be programmatically accessed by the autonomous agent."
  Implementation_Details:
    Action: "Create a root file 'VERSION.txt' containing '0.1.0'. Add a basic 'version' script to the root 'package.json' to easily read this version number."
    Expected_Artifacts:
      - File: "VERSION.txt"
        State: "created"
      - File: "package.json"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the version script returns the correct version."
      Command: "pnpm version"
  Security_Controls:
    - Control: "Auditable Versioning"
      Description: "Ensures that all autonomous changes are traceable to a specific version number, which aids in rollback and auditing processes."
      Verification: "Check the contents of 'VERSION.txt' and the script output."
  Rationale: "The ACA needs a programmatic way to know its own current version before proposing an upgrade, preventing cyclical upgrades and aiding governance."
  Prerequisites: ["001"]

- ID: "017"
  Title: "Generate Initial .gitignore and .dockerignore Files"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Secure Baseline"
    Size: "Small"
    Tags:
      - "git"
      - "security"
      - "config"
  Description: "Create robust ignore files to prevent sensitive data, build artifacts, and environment files from being committed to Git or included in potential container images."
  Implementation_Details:
    Action: "Create the root '.gitignore' and '.dockerignore' files. Explicitly exclude 'node_modules', '*.log', '.env', 'dist', and any temporary Codespaces files."
    Expected_Artifacts:
      - File: ".gitignore"
        State: "created"
      - File: ".dockerignore"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify common build files are ignored by Git."
      Instructions: "Create a file named 'dist/temp.js' and run 'git status' to ensure it is not tracked."
  Security_Controls:
    - Control: "Data Leak Prevention"
      Description: "Prevents accidental commitment of sensitive information (like environment variables or logs) and reduces the attack surface of any generated container image."
      Verification: "Review the ignore files for '.env' and build artifact exclusions."
  Rationale: "Crucial baseline security step. The ACA should never commit its own temporary runtime data or logs."
  Prerequisites: ["001"]

- ID: "018"
  Title: "Configure Initial CI/CD Workflow Skeleton (.github/workflows)"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "CI/CD Setup"
    Size: "Medium"
    Tags:
      - "ci-cd"
      - "github-actions"
      - "governance"
  Description: "Scaffold a basic GitHub Actions CI pipeline that runs on 'pull_request' events, focused on initial setup and validation (lint/test placeholders)."
  Implementation_Details:
    Action: "Create the directory '.github/workflows' and add a file named 'ci.yml'. Define a workflow that triggers on pull requests to 'main', checks out the code, sets up Node.js, runs 'pnpm install', and includes placeholder steps for 'Linting', 'Type Check', and 'Unit Tests'."
    Expected_Artifacts:
      - File: ".github/workflows/ci.yml"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the workflow executes successfully on a new, non-main branch push."
      Instructions: "Push a test branch and open a draft PR to 'main'. Verify the CI run starts and the placeholder jobs pass."
  Security_Controls:
    - Control: "Automated PR Validation Gate"
      Description: "Establishes the mandatory status checks required for merging, serving as the automated component of the human-in-the-loop governance model."
      Verification: "Check the GitHub PR settings to ensure the CI job is required."
  Rationale: "This implements the 'required status checks' mandated by the branch protection rule (Prompt 001) and provides the target for all subsequent validation phases."
  Prerequisites: ["001", "006"]

- ID: "019"
  Title: "Integrate Vitest as the Standard Unit Test Runner"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Validation Setup"
    Size: "Medium"
    Tags:
      - "testing"
      - "vitest"
      - "quality"
  Description: "Install Vitest and configure it for TypeScript unit testing across the monorepo, prioritizing speed and compatibility."
  Implementation_Details:
    Action: "Install 'vitest' and 'ts-node' as dev dependencies. Create a root 'vitest.config.ts' file. Configure Vitest to use a TypeScript environment and to collect coverage data (coverage setup as a placeholder)."
    Expected_Artifacts:
      - File: "vitest.config.ts"
        State: "created"
      - File: "package.json"
        State: "modified"
    Dependencies:
      - Name: "vitest"
        Version: "latest"
        Type: "dev"
      - Name: "ts-node"
        Version: "latest"
        Type: "dev"
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Verify the test runner executes successfully."
      Command: "pnpm test"
    - Type: "Functional_Check"
      Description: "Create a simple placeholder test file ('apps/api/test/setup.spec.ts') and verify it passes."
      Instructions: "Ensure the test command runs without configuration errors."
  Security_Controls:
    - Control: "Test-Driven Security"
      Description: "Foundational step for ensuring that security logic (e.g., input validation) is verifiable via unit tests."
      Verification: "Check 'vitest.config.ts' for correct setup."
  Rationale: "A fast, integrated test suite is essential for the autonomous agent to quickly validate its own generated code patches before proposing them."
  Prerequisites: ["018"]

- ID: "020"
  Title: "Establish Shared Types Package (packages/shared-types)"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Secure Baseline"
    Size: "Small"
    Tags:
      - "typescript"
      - "monorepo"
      - "data-integrity"
  Description: "Create a dedicated monorepo package for shared TypeScript interfaces, DTOs, and utility types to ensure data integrity across the agent's modules."
  Implementation_Details:
    Action: "Create the directory 'packages/shared-types'. Initialize it with a 'package.json' and a dedicated 'tsconfig.json' extending the base config. Create an 'index.ts' export file."
    Expected_Artifacts:
      - File: "packages/shared-types/package.json"
        State: "created"
      - File: "packages/shared-types/tsconfig.json"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the shared types package can be installed and referenced by the 'apps/api' workspace."
      Instructions: "In 'apps/api/package.json', add a dependency on '@aca/shared-types' and verify 'pnpm install' succeeds."
  Security_Controls:
    - Control: "Data Integrity and Consistency"
      Description: "Prevents type confusion errors, which can lead to logic flaws or security vulnerabilities, especially in automatically generated code."
      Verification: "Review the 'apps/api/package.json' for the local dependency reference."
  Rationale: "Critical for a self-modifying system. Consistency in data models reduces the chance of autonomous iteration introducing breaking changes between modules."
  Prerequisites: ["015"]

- ID: "021"
  Title: "Initial NestJS Module and Service for 'System' Health"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Secure Implementation"
    Size: "Medium"
    Tags:
      - "nest-js"
      - "health-check"
      - "core-logic"
  Description: "Scaffold the first core NestJS module, the 'SystemModule', with a basic 'SystemService' to manage environment checks and health status."
  Implementation_Details:
    Action: "Inside 'apps/api/src', create 'system/system.module.ts' and 'system/system.service.ts'. The service should contain a simple 'getHealth' method that returns the current application version (placeholder, to be integrated later)."
    Expected_Artifacts:
      - File: "apps/api/src/system/system.module.ts"
        State: "created"
      - File: "apps/api/src/system/system.service.ts"
        State: "created"
      - File: "apps/api/src/app.module.ts"
        State: "modified"
    Dependencies:
      - Name: "@nestjs/common"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the SystemModule is loaded by the main application."
      Instructions: "Start the application and confirm no dependency injection errors are reported for the SystemService."
  Security_Controls:
    - Control: "Core System Integrity"
      Description: "Provides a defined, isolated area for critical application metadata and health checks, which should be highly protected from autonomous modification."
      Verification: "Check 'app.module.ts' for SystemModule import."
  Rationale: "Establishes the necessary structure for NestJS Dependency Injection, a core principle that the autonomous agent will rely on for modular upgrades."
  Prerequisites: ["012", "020"]

- ID: "022"
  Title: "Implement Initial Unit Test for SystemService"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Validation Setup"
    Size: "Small"
    Tags:
      - "testing"
      - "unit-test"
      - "nest-js"
  Description: "Write a unit test for the 'SystemService.getHealth' method using NestJS testing utilities and Vitest."
  Implementation_Details:
    Action: "Create the test file 'apps/api/src/system/system.service.spec.ts'. Write a test case that verifies 'getHealth' returns a structured object (e.g., '{ status: 'ok' }')."
    Expected_Artifacts:
      - File: "apps/api/src/system/system.service.spec.ts"
        State: "created"
    Dependencies:
      - Name: "@nestjs/testing"
        Version: "latest"
        Type: "dev"
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Verify the SystemService test passes."
      Command: "pnpm run --filter api test"
  Security_Controls:
    - Control: "Code Correctness Verification"
      Description: "Ensures the foundational service logic is verified in isolation, guaranteeing the health check functionality is reliable."
      Verification: "Review the test output for a 'PASS' status on the SystemService spec."
  Rationale: "Test-first approach to foundational modules ensures that all future autonomous refactors and extensions maintain the correct functionality."
  Prerequisites: ["019", "021"]

- ID: "023"
  Title: "Define Root 'package.json' Scripts for Monorepo Operations"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Quality & Consistency"
    Size: "Small"
    Tags:
      - "pnpm"
      - "dx"
      - "scripts"
  Description: "Add standardized, reusable scripts to the root 'package.json' to manage common monorepo tasks like 'install', 'build', 'lint', and 'test' using pnpm filters."
  Implementation_Details:
    Action: "Update the root 'package.json' with scripts: 'pnpm install', 'pnpm --filter=* build', 'pnpm --filter=* lint', 'pnpm --filter=* test'."
    Expected_Artifacts:
      - File: "package.json"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the new scripts execute the underlying commands correctly across all workspaces."
      Command: "pnpm build && pnpm lint && pnpm test"
  Security_Controls:
    - Control: "Operational Standardization"
      Description: "Ensures consistent, predictable execution of development and validation tasks, which is critical for the CI/CD pipeline and the agent's self-testing capability."
      Verification: "Review the script definitions for correct pnpm filter usage."
  Rationale: "Provides a clean interface for human developers and the CI/CD pipeline to interact with the monorepo."
  Prerequisites: ["019", "012"]

- ID: "024"
  Title: "Configure CI/CD Pipeline to Run Unit Tests"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "CI/CD Setup"
    Size: "Medium"
    Tags:
      - "ci-cd"
      - "testing"
      - "github-actions"
  Description: "Update the CI workflow to execute the full unit test suite using the newly created 'pnpm test' script."
  Implementation_Details:
    Action: "Modify '.github/workflows/ci.yml'. Replace the placeholder 'Unit Tests' step with the command 'pnpm test'. Ensure the CI step is configured to fail the workflow if the tests fail."
    Expected_Artifacts:
      - File: ".github/workflows/ci.yml"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the CI workflow correctly executes the tests and reports success."
      Instructions: "Push a change to a test branch. Review the GitHub Actions run to ensure the 'Unit Tests' step completes successfully."
  Security_Controls:
    - Control: "Mandatory Testing Gate"
      Description: "Enforces a mandatory quality gate, ensuring that no autonomous (or human) change is merged without passing a defined level of unit verification."
      Verification: "Check the CI YAML for the explicit 'pnpm test' command and 'fail-fast: true'."
  Rationale: "Completes the integration of the testing framework into the required PR governance workflow."
  Prerequisites: ["018", "023"]

- ID: "025"
  Title: "Initial Security and Dependency Scanning Integration (Snyk/Trivy Placeholder)"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Pre-Commit Security"
    Size: "Medium"
    Tags:
      - "security"
      - "sast"
      - "ci-cd"
  Description: "Add a placeholder step to the CI/CD pipeline for future Snyk/Trivy dependency and SAST scans, ensuring a pre-integration checkpoint."
  Implementation_Details:
    Action: "Modify '.github/workflows/ci.yml'. Add a new step titled 'Security Scan Placeholder' which simply prints a message 'TODO: Integrate Snyk or Trivy scan here.' This marks the required location for future tooling integration."
    Expected_Artifacts:
      - File: ".github/workflows/ci.yml"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the security scan step appears and passes in the CI workflow."
      Instructions: "Review the GitHub Actions run to ensure the 'Security Scan Placeholder' step is executed."
  Security_Controls:
    - Control: "Future Tooling Integration Checkpoint"
      Description: "Ensures the CI pipeline is architected to seamlessly accommodate static and dependency security analysis as mandatory gates later in the process."
      Verification: "Check the CI YAML for the placeholder step."
  Rationale: "Adherence to SSDLC requires defining all security gates early, even if the tools are integrated in a later phase."
  Prerequisites: ["024"]

- ID: "026"
  Title: "Create Shared Utility Package for Constants (packages/utils)"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Quality & Consistency"
    Size: "Small"
    Tags:
      - "monorepo"
      - "utils"
      - "constants"
  Description: "Establish a dedicated monorepo package for environment-agnostic, shared utility functions and non-sensitive constants."
  Implementation_Details:
    Action: "Create the directory 'packages/utils'. Initialize it with 'package.json' and 'tsconfig.json'. Create a simple utility function in 'src/index.ts' (e.g., 'isDevelopment()') and export it."
    Expected_Artifacts:
      - File: "packages/utils/package.json"
        State: "created"
      - File: "packages/utils/src/index.ts"
        State: "created"
      - File: "pnpm-workspace.yaml"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the 'apps/api' workspace can import and use the utility function."
      Instructions: "Install '@aca/utils' in 'apps/api' and call the simple function in 'main.ts'."
  Security_Controls:
    - Control: "Centralized Logic"
      Description: "Enforces the DRY principle for utility functions, ensuring that security-critical logic (like path sanitization, to be added later) is consistent across the entire system."
      Verification: "Review the import/export in the respective files."
  Rationale: "Modular design for a monorepo, facilitating cleaner code generation and maintenance."
  Prerequisites: ["020"]

- ID: "027"
  Title: "Initial DevContainer Setup for GitHub CLI Authentication"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Secure Baseline"
    Size: "Medium"
    Tags:
      - "codespaces"
      - "github-cli"
      - "authentication"
  Description: "Configure the DevContainer to automatically authenticate the GitHub CLI (gh) using the Codespaces token, enabling local Git and GitHub API operations."
  Implementation_Details:
    Action: "Modify '.devcontainer/devcontainer.json' to ensure the 'gh' CLI is available and automatically authenticated via the environment's temporary token using the `postCreateCommand` or similar configuration."
    Expected_Artifacts:
      - File: ".devcontainer/devcontainer.json"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the GitHub CLI is authenticated."
      Command: "gh auth status"
      Instructions: "Launch a Codespace and run the command to ensure it reports a logged-in status with the correct user."
  Security_Controls:
    - Control: "Ephemeral Access Token Usage"
      Description: "Leverages the Codespaces-provided, ephemeral, and scoped access token for GitHub operations, avoiding the need to manually inject or store a PAT within the development environment."
      Verification: "Check 'devcontainer.json' for the relevant authentication settings."
  Rationale: "This is critical for the ACA's testing. It allows the agent to locally run Git commands and mock/simulate Octokit calls using the authenticated Codespaces context."
  Prerequisites: ["005"]

- ID: "028"
  Title: "Establish Standardized Logging Format and Configuration"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Secure Baseline"
    Size: "Medium"
    Tags:
      - "logging"
      - "security"
      - "audit"
  Description: "Install a secure, structured logging library (Winston/Pino) and configure a default logger for the NestJS application, ensuring JSON output for centralized auditing."
  Implementation_Details:
    Action: "Install a logging library (e.g., 'pino-pretty' for development, 'pino' for production). Configure the logger in 'apps/api/src/main.ts' to use a structured, JSON format by default, with an option for pretty printing in the development environment."
    Expected_Artifacts:
      - File: "apps/api/src/main.ts"
        State: "modified"
      - File: "package.json"
        State: "modified"
    Dependencies:
      - Name: "pino"
        Version: "latest"
        Type: "prod"
      - Name: "pino-pretty"
        Version: "latest"
        Type: "dev"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify logs are output in JSON format."
      Instructions: "Run the application and verify the console output is structured JSON, except when using the development logger."
  Security_Controls:
    - Control: "Structured Audit Logging"
      Description: "Mandatory for tracking the autonomous agent's actions. Structured logs are easier to process, search, and audit for suspicious activity or privilege escalation."
      Verification: "Check 'main.ts' for logger instantiation with JSON transport."
  Rationale: "Essential for the human governance team to audit the self-modifying agent's activities in a reliable, machine-readable format."
  Prerequisites: ["012"]

- ID: "029"
  Title: "Initial Configuration of Coverage Thresholds"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "Validation Setup"
    Size: "Small"
    Tags:
      - "testing"
      - "coverage"
      - "quality"
  Description: "Configure Vitest to enforce a mandatory, non-zero code coverage threshold (e.g., 5% initially) to ensure testing is a required part of every new code feature."
  Implementation_Details:
    Action: "Modify 'vitest.config.ts' to include 'coverage.thresholds' that enforce a minimum 5% line, function, and branch coverage globally. This placeholder will be raised in later phases."
    Expected_Artifacts:
      - File: "vitest.config.ts"
        State: "modified"
    Dependencies:
      - Name: "@vitest/coverage-v8"
        Version: "latest"
        Type: "dev"
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Verify the test command calculates and reports coverage."
      Command: "pnpm test --coverage"
  Security_Controls:
    - Control: "Mandatory Test Coverage Enforcement"
      Description: "Prevents the autonomous agent from adding features or modifying code without corresponding tests, maintaining a high level of code correctness and verifiability."
      Verification: "Check 'vitest.config.ts' for the threshold configuration."
  Rationale: "A key quality gate. Start with a low threshold, but make the check mandatory from the beginning."
  Prerequisites: ["019"]

- ID: "030"
  Title: "Final CI/CD Pipeline Integration of Security and Type Checks"
  Metadata:
    Phase: "Foundation & Governance"
    Stage: "CI/CD Setup"
    Size: "Medium"
    Tags:
      - "ci-cd"
      - "type-check"
      - "linting"
  Description: "Finalize the CI workflow by integrating all baseline security and quality checks: full linting, TypeScript type checking, and the audit/vulnerability placeholder."
  Implementation_Details:
    Action: "Modify '.github/workflows/ci.yml'. Add a step for 'pnpm lint' and a separate step for 'pnpm build' with the '--noEmit' flag to perform a pure type-check without generating artifacts."
    Expected_Artifacts:
      - File: ".github/workflows/ci.yml"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the CI workflow executes the full sequence: Lint, Type Check, Unit Test, and Security Placeholder."
      Instructions: "Push a test commit to verify the end-to-end CI pipeline passes successfully."
  Security_Controls:
    - Control: "Full Pre-Merge Validation"
      Description: "Establishes the complete set of mandatory checks that must pass before any autonomous or human code can be reviewed for merging to 'main'."
      Verification: "Review the CI YAML file for the sequential execution of all required validation steps."
  Rationale: "This completes the Foundation Phase by ensuring all governance and quality gates are actively enforced on every Pull Request, fulfilling the core SSDLC requirement."
  Prerequisites: ["024", "023", "003"]
]
```
<details>
<summary>Prompts 031â€“060</summary>

```
[- ID: "031"
  Title: "Define Core DTOs for Autonomous Agent Interaction"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "System Structure"
    Size: "Small"
    Tags:
      - "typescript"
      - "data-integrity"
      - "shared-types"
  Description: "Define the core Data Transfer Objects (DTOs) for the agent's internal operations in the shared-types package, specifically 'PatchRequest' and 'UpgradeProposal'."
  Implementation_Details:
    Action: "In 'packages/shared-types/src/interfaces', create 'agent.interface.ts'. Define 'PatchRequestDTO' (inputs for LLM: file path, current content, goal) and 'UpgradeProposalDTO' (LLM output: file path, proposed content, rationale)."
    Expected_Artifacts:
      - File: "packages/shared-types/src/interfaces/agent.interface.ts"
        State: "created"
    Dependencies:
      - Name: "pnpm"
        Version: "latest"
        Type: "dev"
  Validation_Criteria:
    - Type: "Syntax"
      Description: "Verify the DTOs are correctly exported and type-checked."
      Command: "pnpm run --filter shared-types build"
  Security_Controls:
    - Control: "Data Contract Enforcement"
      Description: "Ensures the input and output of the LLM/Upgrader components adhere to strict, auditable schemas, preventing injection attacks or malformed patches."
      Verification: "Review the 'agent.interface.ts' for proper interface definitions."
  Rationale: "Strict DTOs are the first line of defense against malformed or unexpected data from the LLM, maintaining integrity during the autonomous upgrade loop."
  Prerequisites: ["020"]

- ID: "032"
  Title: "Implement Zod Schema Validation for Agent DTOs"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "System Structure"
    Size: "Medium"
    Tags:
      - "validation"
      - "zod"
      - "security"
  Description: "Integrate Zod to define runtime validation schemas for the Agent DTOs, ensuring data conforms to the expected structure and types at the entry points."
  Implementation_Details:
    Action: "Install 'zod'. In a new file, 'packages/shared-types/src/schemas/agent.schema.ts', define Zod schemas corresponding to 'PatchRequestDTO' and 'UpgradeProposalDTO', with appropriate string, length, and content constraints."
    Expected_Artifacts:
      - File: "packages/shared-types/src/schemas/agent.schema.ts"
        State: "created"
    Dependencies:
      - Name: "zod"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Write a simple unit test in the shared-types package to verify schema enforcement (e.g., test a missing required field)."
      Command: "pnpm run --filter shared-types test"
  Security_Controls:
    - Control: "Runtime Input Sanitization (Zod)"
      Description: "Guarantees that any data received from external sources (like the LLM or environment) is safe and structurally correct before being processed by the agent's core logic."
      Verification: "Review the schema definitions for comprehensive field validation."
  Rationale: "Security by Design principle: Data validation must occur at the runtime boundary, supplementing TypeScript's compile-time checks."
  Prerequisites: ["031", "020"]

- ID: "033"
  Title: "Scaffold Octokit-based GitHubService Module"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Secure Implementation"
    Size: "Medium"
    Tags:
      - "nest-js"
      - "github"
      - "octokit"
  Description: "Create the core 'GitHubModule' and 'GitHubService' in the 'apps/api' to handle all interactions with the GitHub API using Octokit, centralizing the agent's privileged operations."
  Implementation_Details:
    Action: "In 'apps/api/src', create 'github/github.module.ts' and 'github/github.service.ts'. Install 'octokit'. Define a constructor that securely injects the GitHub token via NestJS config, ensuring the service is a singleton."
    Expected_Artifacts:
      - File: "apps/api/src/github/github.module.ts"
        State: "created"
      - File: "apps/api/src/github/github.service.ts"
        State: "created"
    Dependencies:
      - Name: "octokit"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the module loads and the service is instantiable via Dependency Injection."
      Instructions: "Inject the service into a test component and run 'pnpm start:dev'."
  Security_Controls:
    - Control: "Principle of Least Privilege (Centralization)"
      Description: "All privileged API calls are centralized in a single service, making it easy to audit token scope and restrict access to these operations."
      Verification: "Check 'github.service.ts' for token injection only via configuration, not hardcoding."
  Rationale: "Centralizing Octokit access is paramount for security and auditability, allowing for strict control over the token's scope."
  Prerequisites: ["012"]

- ID: "034"
  Title: "Configure Environment Variables and ConfigModule (Node Env & GitHub Token)"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Secret Management"
    Size: "Medium"
    Tags:
      - "config"
      - "secrets"
      - "nest-js"
  Description: "Integrate NestJS ConfigModule to manage environment variables securely, loading the Node environment and the GitHub PAT/Token."
  Implementation_Details:
    Action: "Install '@nestjs/config'. Create a configuration schema file (e.g., 'apps/api/src/config/configuration.ts') that strictly defines and exports environment variables like `NODE_ENV` and `GITHUB_TOKEN`. Integrate this into 'AppModule'."
    Expected_Artifacts:
      - File: "apps/api/src/config/configuration.ts"
        State: "created"
      - File: "apps/api/src/app.module.ts"
        State: "modified"
    Dependencies:
      - Name: "@nestjs/config"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the configuration service correctly loads and exposes variables."
      Instructions: "Inject ConfigService into a placeholder controller and log the environment value."
  Security_Controls:
    - Control: "Secure Secret Injection"
      Description: "Enforces the principle that secrets (like `GITHUB_TOKEN`) are never hardcoded and are always injected at runtime via a configuration service."
      Verification: "Ensure 'process.env' is not accessed directly in application code, but via the ConfigService."
  Rationale: "Standard practice for robust, secure, and portable application configuration, essential for DevSecOps."
  Prerequisites: ["033"]

- ID: "035"
  Title: "Initial Draft of OpenAPI Specification (YAML)"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "System Structure"
    Size: "Medium"
    Tags:
      - "openapi"
      - "documentation"
      - "api-contract"
  Description: "Draft the initial OpenAPI 3.0 specification for the agent's conceptual HTTP entry point (if any) and its internal APIs, focusing on the core 'Run Agent' function."
  Implementation_Details:
    Action: "Create 'docs/openapi.yaml'. Define the '/api/v1/run-agent' endpoint (likely triggered by a secure webhook/internal CI action) and use the DTOs defined in Prompt 031 for the request/response schemas."
    Expected_Artifacts:
      - File: "docs/openapi.yaml"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Syntax"
      Description: "Verify the YAML is valid OpenAPI 3.0 using an online validator."
      Instructions: "N/A (Developer-executed check)."
  Security_Controls:
    - Control: "API Contract Enforcement"
      Description: "Defines a strict, non-negotiable external boundary for the agent, mitigating attacks via malformed API requests."
      Verification: "Review the YAML for complete schema definitions corresponding to the DTOs."
  Rationale: "Documenting the API contract upfront provides a clear, versioned interface for the human governance system and any external triggers."
  Prerequisites: ["032"]

- ID: "036"
  Title: "Create Local Development Docker Compose (Database Mock)"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Local Environment"
    Size: "Medium"
    Tags:
      - "docker"
      - "local-dev"
      - "security"
  Description: "Create 'docker-compose.dev.yml' to set up a secure local environment, including a simple Redis cache and a PostgreSQL container (even if not strictly used, it sets up the standard dev environment)."
  Implementation_Details:
    Action: "Create 'docker-compose.dev.yml'. Define services for a secure PostgreSQL instance (with defined volume and password via .env file) and a Redis container. Map necessary ports."
    Expected_Artifacts:
      - File: "docker-compose.dev.yml"
        State: "created"
    Dependencies:
      - Name: "docker-compose"
        Version: "latest"
        Type: "dev"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the containers start securely."
      Command: "docker compose -f docker-compose.dev.yml up -d"
      Instructions: "Verify the Postgres container password is not exposed in the compose file."
  Security_Controls:
    - Control: "Secure Local Credential Management"
      Description: "Forces the use of environment variables for local database credentials, preventing cleartext secrets from being committed."
      Verification: "Ensure all secrets in the compose file reference environment variables (e.g., `POSTGRES_PASSWORD: ${DB_PASSWORD}`)."
  Rationale: "Provides a reproducible local environment for development and E2E testing, adhering to security best practices for credentials."
  Prerequisites: ["005"]

- ID: "037"
  Title: "Configure Local .env File for Codespaces/Docker Secrets"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Local Environment"
    Size: "Small"
    Tags:
      - "secrets"
      - "local-dev"
      - "security"
  Description: "Create a template '.env.example' and a development-only '.env' file for local secrets, ensuring '.env' is correctly ignored by Git."
  Implementation_Details:
    Action: "Create the local '.env' file with placeholder values for `GITHUB_TOKEN`, `LLM_API_KEY`, and `DB_PASSWORD`. Create '.env.example' with non-sensitive placeholders. Ensure '.env' is in '.gitignore'."
    Expected_Artifacts:
      - File: ".env"
        State: "created"
      - File: ".env.example"
        State: "created"
      - File: ".gitignore"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the .env file is excluded from Git tracking."
      Instructions: "Run 'git status' after creating the .env file; it should not appear."
  Security_Controls:
    - Control: "Local Secret Separation"
      Description: "Critical security control preventing accidental commitment of development secrets. The agent must never expose secrets to Git."
      Verification: "Check '.gitignore' for explicit exclusion of '.env'."
  Rationale: "Segregation of secrets from code is the most fundamental security requirement for any application."
  Prerequisites: ["036", "017"]

- ID: "038"
  Title: "Scaffold LLM Client Service with Secure API Key Integration"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Secure Implementation"
    Size: "Medium"
    Tags:
      - "llm"
      - "openai"
      - "security"
  Description: "Create the 'LLMModule' and 'LLMService' to manage the connection to the OpenAI API, strictly injecting the API key from the configuration service."
  Implementation_Details:
    Action: "In 'apps/api/src', create 'llm/llm.module.ts' and 'llm/llm.service.ts'. Install the OpenAI SDK. Define a constructor that receives the `LLM_API_KEY` via the NestJS ConfigService, centralizing API key usage."
    Expected_Artifacts:
      - File: "apps/api/src/llm/llm.module.ts"
        State: "created"
      - File: "apps/api/src/llm/llm.service.ts"
        State: "created"
    Dependencies:
      - Name: "openai"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the LLMService is instantiable without runtime errors."
      Instructions: "Inject the service into a test component and run 'pnpm start:dev'."
  Security_Controls:
    - Control: "Secure Secret Handling (LLM API Key)"
      Description: "Ensures the highly sensitive LLM API key is handled securely via dependency injection, limiting its exposure and logging."
      Verification: "Check 'llm.service.ts' for API key injection only through the ConfigService."
  Rationale: "This service acts as the trusted gatekeeper between the agent and the external LLM, enforcing security boundaries."
  Prerequisites: ["034"]

- ID: "039"
  Title: "Initial Implementation of GitClient Service (Local Operations)"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Secure Implementation"
    Size: "Medium"
    Tags:
      - "git"
      - "file-system"
      - "nest-js"
  Description: "Create the 'GitModule' and 'GitClientService' to wrap local Git and file system operations, which is the core of the agent's execution."
  Implementation_Details:
    Action: "In 'apps/api/src', create 'git/git-client.module.ts' and 'git/git-client.service.ts'. Use Node's built-in 'child_process' to wrap core Git operations like 'git status', 'git add', and 'git apply' (placeholder). Use absolute paths for all file operations."
    Expected_Artifacts:
      - File: "apps/api/src/git/git-client.module.ts"
        State: "created"
      - File: "apps/api/src/git/git-client.service.ts"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the GitClientService can execute a simple command."
      Instructions: "Add a test method to the service to run 'git status' and confirm the output."
  Security_Controls:
    - Control: "Command Injection Mitigation (Abstraction)"
      Description: "Centralizing all command execution prevents direct user/LLM input from reaching the shell, mitigating OS command injection vulnerabilities."
      Verification: "Ensure all commands in the service are executed using an array of arguments (e.g., `exec('git', ['status', '--short'])`) rather than concatenated strings."
  Rationale: "The Git client is the most sensitive part of the agent. Abstraction is mandatory to ensure command safety."
  Prerequisites: ["012"]

- ID: "040"
  Title: "Create Base Unit Test Environment for GitClientService"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Validation Setup"
    Size: "Small"
    Tags:
      - "testing"
      - "git"
      - "unit-test"
  Description: "Establish a mock environment for the GitClientService unit tests to isolate file system and command execution without touching the actual repository."
  Implementation_Details:
    Action: "Create the test file 'apps/api/src/git/git-client.service.spec.ts'. Use Jest/Vitest mocking utilities to mock the 'child_process.exec' method and the underlying file system operations."
    Expected_Artifacts:
      - File: "apps/api/src/git/git-client.service.spec.ts"
        State: "created"
    Dependencies:
      - Name: "vitest"
        Version: "latest"
        Type: "dev"
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Verify a simple mocked command test passes."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Isolated Testing Environment"
      Description: "Prevents accidental modification of the actual codebase during test execution, even if the agent's logic is flawed."
      Verification: "Check the test file for extensive use of mocking functions for 'child_process'."
  Rationale: "Testing a self-modifying agent requires extreme isolation. This prevents tests from creating security incidents during development."
  Prerequisites: ["039", "022"]

- ID: "041"
  Title: "Implement Environment Variable Schema Validation (NestJS Config)"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Secret Management"
    Size: "Medium"
    Tags:
      - "validation"
      - "config"
      - "security"
  Description: "Enhance the NestJS ConfigModule with Zod schema validation to ensure all critical environment variables (`GITHUB_TOKEN`, `LLM_API_KEY`) are present and meet minimum security requirements at startup."
  Implementation_Details:
    Action: "Integrate Zod into the ConfigModule setup in 'apps/api/src/app.module.ts'. Define a Zod schema to validate that `GITHUB_TOKEN` and `LLM_API_KEY` are non-empty strings."
    Expected_Artifacts:
      - File: "apps/api/src/app.module.ts"
        State: "modified"
      - File: "apps/api/src/config/configuration.ts"
        State: "modified"
    Dependencies:
      - Name: "@nestjs/config"
        Version: "latest"
        Type: "prod"
      - Name: "zod"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify application startup fails if a critical environment variable is missing."
      Instructions: "Remove `GITHUB_TOKEN` from the local '.env' file and attempt to run 'pnpm start:dev'. Verify startup throws a validation error."
  Security_Controls:
    - Control: "Mandatory Secret Presence Check"
      Description: "Guarantees the agent never attempts a privileged operation (GitHub API call) without the necessary credentials, preventing runtime errors and ensuring a secure process flow."
      Verification: "Review the ConfigModule initialization for the Zod schema integration."
  Rationale: "Fail-fast principle for configuration. Secrets are too critical to be checked only when accessed."
  Prerequisites: ["034", "032"]

- ID: "042"
  Title: "Define Core Agent Controller and Entry Point"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "System Structure"
    Size: "Small"
    Tags:
      - "nest-js"
      - "api-contract"
      - "controller"
  Description: "Create the primary 'AgentController' that implements the external API contract (from Prompt 035), serving as the single entry point for triggering the autonomous run loop."
  Implementation_Details:
    Action: "In 'apps/api/src', create 'agent/agent.controller.ts'. Define a POST route, `/api/v1/run-agent`, which calls a placeholder method in a new 'AgentService'. Use appropriate NestJS decorators."
    Expected_Artifacts:
      - File: "apps/api/src/agent/agent.controller.ts"
        State: "created"
      - File: "apps/api/src/agent/agent.module.ts"
        State: "created"
    Dependencies:
      - Name: "@nestjs/platform-express"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the route is accessible and responds to a request."
      Instructions: "Run 'pnpm start:dev' and use curl or Postman to send a POST request to the route."
  Security_Controls:
    - Control: "Single Entry Point"
      Description: "Centralizes external access to the agent's execution, allowing for easy application of security middleware (e.g., source IP restriction or authentication headers)."
      Verification: "Ensure no other controllers are defined for the execution flow."
  Rationale: "Simplifies governance and security auditing by creating a clear, single point of failure/success for external triggers."
  Prerequisites: ["035", "012"]

- ID: "043"
  Title: "Define Agent Service (Orchestrator) Module Skeleton"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "System Structure"
    Size: "Small"
    Tags:
      - "nest-js"
      - "orchestration"
      - "core-logic"
  Description: "Create the 'AgentService', the orchestrator of the entire autonomous workflow (Planner, LLM, Executor, GitClient)."
  Implementation_Details:
    Action: "In 'apps/api/src/agent', create 'agent.service.ts'. Define the main method `runAutonomousUpgrade()` (placeholder). Inject the `GitHubService`, `LLMService`, and `GitClientService` in the constructor."
    Expected_Artifacts:
      - File: "apps/api/src/agent/agent.service.ts"
        State: "created"
      - File: "apps/api/src/agent/agent.module.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the service is correctly loaded and all dependencies are resolved by NestJS DI."
      Instructions: "Start the application and confirm no dependency injection errors for the service."
  Security_Controls:
    - Control: "Centralized Flow Control"
      Description: "Ensures the entire self-modification process is executed in a highly controlled sequence, preventing unexpected interactions or privilege escalation across modules."
      Verification: "Review the constructor for mandatory injection of all privileged services."
  Rationale: "Adherence to NestJS modularity for testability and structural integrity, which is essential for a self-upgrading system."
  Prerequisites: ["042", "033", "038", "039"]

- ID: "044"
  Title: "Initial Draft of Agent Execution Loop Pseudocode (ADR 002)"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Threat Modeling"
    Size: "Large"
    Tags:
      - "architecture"
      - "governance"
      - "flow-control"
  Description: "Create a new Architecture Decision Record (ADR 002) detailing the high-level, secure execution loop of the autonomous agent, including all safety gates."
  Implementation_Details:
    Action: "Create 'docs/adr/0002-agent-execution-loop.md'. Document the sequence: 1. **Plan** (Decide what to do), 2. **Generate** (Call LLM), 3. **Validate** (Local tests/SAST), 4. **Execute** (Git commit/PR), 5. **Govern** (Human approval). Explicitly list the location of security checks."
    Expected_Artifacts:
      - File: "docs/adr/0002-agent-execution-loop.md"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the ADR is comprehensive and includes the 'Human-in-the-Loop' governance step."
      Instructions: "Review the document's content for completeness and clarity."
  Security_Controls:
    - Control: "Process Auditing and Accountability"
      Description: "Mandates that the high-level workflow is documented and auditable, ensuring the human governance team understands and approves the agent's internal security model."
      Verification: "Ensure the governance step is the final stage before merging."
  Rationale: "Crucial for communicating the 'Human-in-the-Loop' model. The agent's code must match this documented, secure flow."
  Prerequisites: ["043", "008"]

- ID: "045"
  Title: "Configure Local Development Script with Environment Loading"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Local Environment"
    Size: "Small"
    Tags:
      - "local-dev"
      - "scripts"
      - "dx"
  Description: "Modify the local start script to automatically load the '.env' file, ensuring the Codespaces environment variables are correctly injected into the application."
  Implementation_Details:
    Action: "Install 'dotenv'. Update the 'apps/api' 'start:dev' script in its 'package.json' to use `dotenv/config` before launching NestJS (e.g., `node -r dotenv/config ...`)."
    Expected_Artifacts:
      - File: "apps/api/package.json"
        State: "modified"
    Dependencies:
      - Name: "dotenv"
        Version: "latest"
        Type: "dev"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the local environment variables are loaded and accessible by the ConfigService."
      Instructions: "Run 'pnpm start:dev --filter api' and confirm the ConfigService successfully reads a variable from the .env file."
  Security_Controls:
    - Control: "Controlled Secret Loading"
      Description: "Ensures the development environment consistently and securely loads non-hardcoded secrets, matching the pattern used in production environments."
      Verification: "Check the start script for the correct `dotenv/config` usage."
  Rationale: "Enhances Developer Experience (DX) and ensures local testing is conducted with realistic, securely loaded secrets."
  Prerequisites: ["037", "041"]

- ID: "046"
  Title: "Initial Definition of File Path Whitelist/Blacklist Logic"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Secure Implementation"
    Size: "Medium"
    Tags:
      - "governance"
      - "security"
      - "constants"
  Description: "Define the application constants for the core security feature: a whitelist of files/directories the agent is **allowed** to modify (e.g., 'apps/api/src') and a blacklist of files it **must never** touch (e.g., '.env', security config files)."
  Implementation_Details:
    Action: "In 'packages/utils/src/constants.ts', define `MODIFIABLE_PATHS` (array of allowed glob patterns) and `PROTECTED_PATHS` (array of critical files like `SECURITY.md`, CI YAMLs, `.env`)."
    Expected_Artifacts:
      - File: "packages/utils/src/constants.ts"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the constants file is correctly accessible and exported."
      Instructions: "Import and log one of the constant arrays in the 'AgentService' to confirm accessibility."
  Security_Controls:
    - Control: "File Path Restriction Governance"
      Description: "Crucial safety gate for a self-modifying agent. This hardcoded list prevents the agent from making unapproved changes to governance, infrastructure, or secret files."
      Verification: "Review the arrays to ensure all governance and security files are included in `PROTECTED_PATHS`."
  Rationale: "Hardcoding the security boundary is the only way to guarantee the agent cannot autonomously remove its own safety gates."
  Prerequisites: ["026", "043"]

- ID: "047"
  Title: "Scaffold Planner Service Module Skeleton"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "System Structure"
    Size: "Small"
    Tags:
      - "nest-js"
      - "core-logic"
      - "planner"
  Description: "Create the 'PlannerService' module skeleton, which will be responsible for analyzing the repository's state and deciding on the next autonomous task."
  Implementation_Details:
    Action: "In 'apps/api/src/agent/planner', create 'planner.service.ts' and 'planner.module.ts'. Define a placeholder method `determineNextAction(): Promise<PatchRequestDTO[]>`."
    Expected_Artifacts:
      - File: "apps/api/src/agent/planner/planner.service.ts"
        State: "created"
      - File: "apps/api/src/agent/planner/planner.module.ts"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the PlannerService is correctly loaded by the AgentModule."
      Instructions: "Update AgentModule to import PlannerModule and confirm DI resolution on application startup."
  Security_Controls:
    - Control: "Modular Logic Isolation"
      Description: "Isolates the complex decision-making logic from the execution logic, simplifying security auditing and preventing the planner from having direct access to privileged APIs."
      Verification: "Check the module structure for clear separation."
  Rationale: "Modular, decoupled architecture is key to the agent's scalability and testability."
  Prerequisites: ["043", "031"]

- ID: "048"
  Title: "Scaffold Executor Service Module Skeleton"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "System Structure"
    Size: "Small"
    Tags:
      - "nest-js"
      - "core-logic"
      - "executor"
  Description: "Create the 'ExecutorService' module skeleton, which will be responsible for applying the patch, running tests, and managing the Git workflow."
  Implementation_Details:
    Action: "In 'apps/api/src/agent/executor', create 'executor.service.ts' and 'executor.module.ts'. Define a placeholder method `executeUpgrade(proposals: UpgradeProposalDTO[]): Promise<boolean>`."
    Expected_Artifacts:
      - File: "apps/api/src/agent/executor/executor.service.ts"
        State: "created"
      - File: "apps/api/src/agent/executor/executor.module.ts"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the ExecutorService is correctly loaded by the AgentModule."
      Instructions: "Update AgentModule to import ExecutorModule and confirm DI resolution on application startup."
  Security_Controls:
    - Control: "Execution Logic Isolation"
      Description: "Isolates the file system and Git execution logic, simplifying security auditing and allowing the AgentService to act as a security proxy between the Planner and the Executor."
      Verification: "Check the module structure for clear separation."
  Rationale: "This implements the 'Layered Architecture' principle, ensuring clear responsibilities between decision-making (Planner) and action (Executor)."
  Prerequisites: ["043", "031", "047"]

- ID: "049"
  Title: "Finalize GitClient Service - Implement 'applyPatch' and 'gitCommit' Mock"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Secure Implementation"
    Size: "Medium"
    Tags:
      - "git"
      - "security"
      - "file-system"
  Description: "Implement the secure core Git operations in `GitClientService`: `applyPatch(proposal)` (writes the change) and `gitCommit(message)` (commits the change)."
  Implementation_Details:
    Action: "In 'apps/api/src/git/git-client.service.ts', implement placeholder logic for `applyPatch` (to write file content to a file path) and `gitCommit` (to execute the actual git command). Enforce path sanitation using Node's `path.join` and only allow relative paths."
    Expected_Artifacts:
      - File: "apps/api/src/git/git-client.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Add a test to verify `applyPatch` fails if the path is outside the allowed modification directory (e.g., attempts to modify `/etc/passwd`)."
      Command: "pnpm test --filter api --coverage"
  Security_Controls:
    - Control: "Path Traversal Mitigation"
      Description: "Absolute security requirement. Prevents the autonomous agent from using '..' sequences in a file path to overwrite system or protected files outside the allowed codebase."
      Verification: "Check the service methods for explicit path sanitation and validation against the `MODIFIABLE_PATHS` constant."
  Rationale: "Without this, the agent is a dangerous, self-modifying system with system-level command injection potential."
  Prerequisites: ["046", "039", "040"]

- ID: "050"
  Title: "Initial Implementation of Logging Interceptor for Audit Trails"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Secure Implementation"
    Size: "Medium"
    Tags:
      - "security"
      - "logging"
      - "nest-js"
  Description: "Implement a global NestJS Interceptor to automatically log the start and end of the critical execution flow, providing a mandatory audit trail."
  Implementation_Details:
    Action: "Create 'apps/api/src/common/interceptors/logging.interceptor.ts'. Implement a logging interceptor that records the execution time, method, and status of every controller request, logging sensitive details (like request bodies) only at the DEBUG level or lower."
    Expected_Artifacts:
      - File: "apps/api/src/common/interceptors/logging.interceptor.ts"
        State: "created"
      - File: "apps/api/src/main.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify structured logs appear for every incoming request."
      Instructions: "Send a request to the '/run-agent' endpoint and verify a JSON log entry is generated for the request and response."
  Security_Controls:
    - Control: "Mandatory Request/Response Audit Logging"
      Description: "Provides an undeniable, high-level audit trail of every time the agent's core function is externally triggered, which is essential for forensic analysis."
      Verification: "Check 'main.ts' for global application of the interceptor."
  Rationale: "Standard security practice for API services, mandatory for an autonomous system where execution needs clear boundaries and auditability."
  Prerequisites: ["042", "028"]

- ID: "051"
  Title: "Implement Unit Test for LLMService Dependency Injection"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Validation Setup"
    Size: "Small"
    Tags:
      - "testing"
      - "llm"
      - "unit-test"
  Description: "Create a unit test for the LLMService to ensure it correctly initializes the OpenAI client using the securely injected API key from the ConfigService."
  Implementation_Details:
    Action: "Create 'apps/api/src/llm/llm.service.spec.ts'. Write a test that mocks the ConfigService to return a placeholder API key and verifies the LLMService instance is created without errors."
    Expected_Artifacts:
      - File: "apps/api/src/llm/llm.service.spec.ts"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Verify the LLMService test passes in isolation."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Configuration Integrity Check"
      Description: "Verifies the secure configuration pattern for the most sensitive secret (the LLM API key) is working as designed."
      Verification: "Review the test for proper mocking of the ConfigService."
  Rationale: "Validating secure secret handling is a non-negotiable step in the architecture phase."
  Prerequisites: ["038", "041", "022"]

- ID: "052"
  Title: "Define Shared Security Configuration Constants (Rate Limits, Headers)"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Secure Implementation"
    Size: "Small"
    Tags:
      - "security"
      - "constants"
      - "governance"
  Description: "Define security-critical constants such as default rate-limiting values and mandatory security headers to be implemented in later phases."
  Implementation_Details:
    Action: "Modify 'packages/utils/src/constants.ts'. Add constants like `RATE_LIMIT_MAX_REQUESTS` (e.g., 10), `RATE_LIMIT_TIME_WINDOW_MS` (e.g., 60000), and a list of `MANDATORY_SECURITY_HEADERS` (e.g., HSTS, X-Frame-Options)."
    Expected_Artifacts:
      - File: "packages/utils/src/constants.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the new constants are defined with reasonable, secure defaults."
      Instructions: "Review the file content."
  Security_Controls:
    - Control: "Hardcoded Security Policy"
      Description: "Ensures the autonomous agent cannot accidentally (or maliciously) change the application's core security policy settings, which are derived from a human-governed standard."
      Verification: "Check the constants for robust default values."
  Rationale: "Separation of policy from implementation is key for security. The human sets the policy; the agent implements it."
  Prerequisites: ["046"]

- ID: "053"
  Title: "Initial Draft of Agent Health Monitoring Script (Standalone)"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "System Structure"
    Size: "Small"
    Tags:
      - "observability"
      - "health-check"
      - "shell"
  Description: "Create a simple, standalone shell script ('scripts/healthcheck.sh') to verify the local repository is clean and the agent is runnable, for use by the CI/CD pipeline."
  Implementation_Details:
    Action: "Create 'scripts/healthcheck.sh'. The script should check for: 1. `git status --porcelain` (to ensure a clean working directory before execution), and 2. Successful compilation (`pnpm build`). Make the script executable."
    Expected_Artifacts:
      - File: "scripts/healthcheck.sh"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the script runs correctly and fails if the working directory is dirty."
      Command: "chmod +x scripts/healthcheck.sh && scripts/healthcheck.sh"
  Security_Controls:
    - Control: "Execution Pre-Condition Check"
      Description: "Ensures the agent only runs when the repository is in a known, clean state, preventing autonomous operations from running on partially applied or uncommitted changes."
      Verification: "Check the script for the `git status` check with a non-zero exit code on failure."
  Rationale: "Mandatory operational check for a system that modifies its own source code."
  Prerequisites: ["018", "023"]

- ID: "054"
  Title: "Initial GitClient Implementation: Get Current Branch and Repository Name"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Secure Implementation"
    Size: "Small"
    Tags:
      - "git"
      - "metadata"
      - "nest-js"
  Description: "Add methods to the `GitClientService` to securely retrieve the current branch name and the repository owner/name, essential for Octokit calls."
  Implementation_Details:
    Action: "In 'apps/api/src/git/git-client.service.ts', implement methods to execute 'git rev-parse --abbrev-ref HEAD' (for branch name) and to parse the remote URL (e.g., from `gh repo view --json owner,name`) for the repository details."
    Expected_Artifacts:
      - File: "apps/api/src/git/git-client.service.ts"
        State: "modified"
    Dependencies:
      - Name: "@nestjs/common"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Add unit tests to verify the methods correctly parse mock command outputs."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Repository Context Integrity"
      Description: "Ensures the agent is aware of its own operational context before attempting any remote action, preventing cross-repository contamination or accidental execution on the wrong branch."
      Verification: "Check the service methods for safe command execution and parsing."
  Rationale: "The agent needs to know exactly where it is operating to maintain security and integrity."
  Prerequisites: ["049", "027"]

- ID: "055"
  Title: "Initial GitHubService Implementation: Get Current User"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Secure Implementation"
    Size: "Small"
    Tags:
      - "github"
      - "octokit"
      - "security"
  Description: "Add a method to the `GitHubService` to verify the authenticated user (i.e., the agent itself) and its scope permissions."
  Implementation_Details:
    Action: "In 'apps/api/src/github/github.service.ts', implement a method `getAuthenticatedUser()` that calls the Octokit `rest.users.getAuthenticated()` endpoint. This confirms the PAT is valid and identifies the agent."
    Expected_Artifacts:
      - File: "apps/api/src/github/github.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Write a unit test that mocks the Octokit response to verify correct user data parsing."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Token Scope Verification (Post-Authentication)"
      Description: "Verifies the token's identity and permissions on every run, preventing a malicious or overly-permissive token from being used without human oversight."
      Verification: "Check the method for use of the authenticated Octokit endpoint."
  Rationale: "Mandatory security check to ensure the agent is operating under the expected, least-privilege identity."
  Prerequisites: ["033"]

- ID: "056"
  Title: "Implement Custom NestJS Exception Filter for Audit Logging"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Secure Implementation"
    Size: "Medium"
    Tags:
      - "security"
      - "logging"
      - "error-handling"
  Description: "Create a global Exception Filter to catch all unhandled exceptions, ensuring critical errors are logged in a structured format before a response is sent."
  Implementation_Details:
    Action: "Create 'apps/api/src/common/filters/http-exception.filter.ts'. Implement a filter that logs the exception stack trace and request metadata using the structured logger, but only exposes non-sensitive error messages to the client."
    Expected_Artifacts:
      - File: "apps/api/src/common/filters/http-exception.filter.ts"
        State: "created"
      - File: "apps/api/src/main.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify an unhandled error is logged and a generic 500 status is returned."
      Instructions: "Force a runtime error in a controller method and check the structured logs and the client response."
  Security_Controls:
    - Control: "Information Disclosure Prevention (Error Handling)"
      Description: "Prevents stack traces and internal system details from being exposed to the client, mitigating reconnaissance attacks. Full details are kept in the secure audit logs."
      Verification: "Check the filter for explicit stripping of sensitive information from the client response."
  Rationale: "Secure and structured error handling is a core DevSecOps requirement for production systems."
  Prerequisites: ["050"]

- ID: "057"
  Title: "Create Final Dockerfile for Agent (Production Build)"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "System Structure"
    Size: "Large"
    Tags:
      - "docker"
      - "security"
      - "build"
  Description: "Create the production multi-stage Dockerfile for the autonomous agent, prioritizing security (non-root user, minimal base image)."
  Implementation_Details:
    Action: "Create 'apps/api/Dockerfile'. Use a multi-stage build: 1. Builder stage (Node.js LTS, pnpm, build artifacts), 2. Runtime stage (Alpine or slim Node base, non-root user, only 'dist' and necessary 'node_modules'). Set the startup command."
    Expected_Artifacts:
      - File: "apps/api/Dockerfile"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the image builds successfully and runs as a non-root user."
      Command: "docker build -t agent-api ./apps/api && docker run --rm agent-api whoami"
  Security_Controls:
    - Control: "Non-Root User / Minimal Attack Surface"
      Description: "Reduces the blast radius of a container escape by running the agent as a non-privileged user within a minimal environment."
      Verification: "Check the runtime stage for `USER nonroot` or similar directive."
  Rationale: "Containerization security best practices, mandatory for a production autonomous system."
  Prerequisites: ["017", "012"]

- ID: "058"
  Title: "Update CI/CD Pipeline to Include Docker Build Check"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "CI/CD Setup"
    Size: "Small"
    Tags:
      - "ci-cd"
      - "docker"
      - "github-actions"
  Description: "Modify the CI workflow to include a check that validates the production Docker image builds successfully."
  Implementation_Details:
    Action: "Modify '.github/workflows/ci.yml'. Add a step 'Docker Build Verification' after the main build and test steps. Use `docker build` with the `--no-cache` flag to ensure a fresh build check."
    Expected_Artifacts:
      - File: ".github/workflows/ci.yml"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the CI run executes the Docker build check successfully."
      Instructions: "Push a test commit and observe the GitHub Actions run."
  Security_Controls:
    - Control: "Build Integrity Check"
      Description: "Guarantees that the final deployable artifact (the container) is always valid and can be generated from the committed source code."
      Verification: "Check the CI YAML for the explicit `docker build` command."
  Rationale: "Prevents failed deployments due to broken container build processes."
  Prerequisites: ["057", "030"]

- ID: "059"
  Title: "Create Prettier Ignore File"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Quality & Consistency"
    Size: "Small"
    Tags:
      - "config"
      - "formatting"
  Description: "Create a '.prettierignore' file to exclude automatically generated files (e.g., build outputs, documentation) and external configuration files from formatting."
  Implementation_Details:
    Action: "Create the root '.prettierignore' file. Exclude 'dist/', 'node_modules/', 'docs/openapi.yaml', and '.env.example' to prevent unnecessary or accidental formatting of generated content."
    Expected_Artifacts:
      - File: ".prettierignore"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the excluded files are not formatted."
      Instructions: "Run 'pnpm prettier --write docs/openapi.yaml' and verify the file is not changed."
  Security_Controls:
    - Control: "Configuration Lock-down"
      Description: "Prevents the formatting tool from corrupting or making unnecessary changes to machine-generated artifacts (like the OpenAPI spec) or governance files, which would clutter autonomous agent PRs."
      Verification: "Review the exclusions in '.prettierignore'."
  Rationale: "Improves DX and reduces noise in Git history."
  Prerequisites: ["003", "035"]

- ID: "060"
  Title: "Finalize Architecture Documentation Structure"
  Metadata:
    Phase: "Architecture & Secure Infrastructure"
    Stage: "Project Governance"
    Size: "Small"
    Tags:
      - "documentation"
      - "governance"
      - "architecture"
  Description: "Organize the 'docs/' directory to include sub-folders for 'Architecture Decision Records (ADR)', 'Threat Models', and general 'Operations' guides."
  Implementation_Details:
    Action: "Create the following subdirectories: 'docs/adr', 'docs/threat-models', 'docs/ops'. Move existing ADRs and Threat Models into their respective folders."
    Expected_Artifacts:
      - File: "docs/adr/0001-architecture-decision.md"
        State: "modified"
      - File: "docs/threat-models/threat-model-v1.md"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify all documentation is correctly relocated."
      Instructions: "Confirm file paths match the new structure."
  Security_Controls:
    - Control: "Documentation Auditing Structure"
      Description: "A clear structure for governance documents ensures that auditors can quickly locate the threat model and architectural decisions that justify the agent's security controls."
      Verification: "N/A"
  Rationale: "Improves long-term maintainability and compliance auditing for the human governance team."
  Prerequisites: ["044", "010"]]
```
</details>

<details>
<summary>Prompts 061â€“090</summary>

```
[- ID: "061"
  Title: "Implement GitClient Service - Secure File Read/Write Operations"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "git"
      - "security"
      - "file-system"
  Description: "Implement the secure file read and write operations in `GitClientService`, ensuring all paths are sanitized and validated against the `MODIFIABLE_PATHS` constant before any operation."
  Implementation_Details:
    Action: "In 'apps/api/src/git/git-client.service.ts', implement `readFile(path)` and `writeFile(path, content)`. Before file system access, use the `path` module to resolve the path and then check if the path is contained within any of the `MODIFIABLE_PATHS` defined in the shared constants. Throw a security exception if the path is restricted."
    Expected_Artifacts:
      - File: "apps/api/src/git/git-client.service.ts"
        State: "modified"
    Dependencies:
      - Name: "@nestjs/common"
        Version: "latest"
        Type: "prod"
      - Name: "path"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Add unit tests to verify that attempts to read/write a file outside of 'apps/api/src' (e.g., '../../package.json') fail with a security exception."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Path Restriction Enforcement (L3)"
      Description: "Provides mandatory, deep-level path traversal mitigation, ensuring the autonomous agent cannot modify governance or infrastructure files."
      Verification: "Review the `readFile` and `writeFile` methods for explicit path validation logic."
  Rationale: "This implements the 'sandboxing' concept within the agent's execution layer, a core security requirement."
  Prerequisites: ["060", "049", "046"]

- ID: "062"
  Title: "Implement LLMService - Secure 'generatePatch' Function Skeleton"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "llm"
      - "openai"
      - "api-contract"
  Description: "Implement the core `generatePatch` method in `LLMService`, handling the structured request/response with the LLM and using the validated `PatchRequestDTO`."
  Implementation_Details:
    Action: "In 'apps/api/src/llm/llm.service.ts', implement `generatePatch(request: PatchRequestDTO)`. This method should use the injected OpenAI client to call a code generation endpoint (e.g., ChatCompletions) with a system prompt detailing the agent's security constraints and required JSON output format (matching `UpgradeProposalDTO`)."
    Expected_Artifacts:
      - File: "apps/api/src/llm/llm.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Add a unit test that mocks the OpenAI API response and verifies the service correctly parses the (mocked) JSON output into an `UpgradeProposalDTO` array."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Structured Response Enforcement"
      Description: "Forces the LLM output to conform to the defined DTO structure, simplifying post-generation validation and mitigating risk from unstructured or unexpected LLM responses."
      Verification: "Check the service for clear instruction to the LLM to return JSON in a specific schema."
  Rationale: "The LLM is an external, untrusted source. All its inputs and outputs must be strictly governed by defined contracts."
  Prerequisites: ["038", "031", "032"]

- ID: "063"
  Title: "Implement LLMService - Response Validation and JSON Schema Guard"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "llm"
      - "validation"
      - "security"
  Description: "Enhance `LLMService.generatePatch` to include mandatory Zod validation of the LLM's raw JSON output against the `UpgradeProposalDTO` schema."
  Implementation_Details:
    Action: "In `LLMService.generatePatch`, after receiving the JSON response from the LLM, use the Zod schema from Prompt 032 to perform a runtime validation (`schema.parse(response)`). If validation fails, log the failure and throw a structured error, preventing bad data from entering the execution pipeline."
    Expected_Artifacts:
      - File: "apps/api/src/llm/llm.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Modify the unit test (062) to simulate a malformed LLM response (e.g., missing 'rationale' field) and assert that the service correctly throws a Zod validation error."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Post-LLM Output Validation"
      Description: "Critical security gate. This ensures that even if the LLM 'hallucinates' or ignores the JSON format instructions, the agent's core execution logic only proceeds with valid, auditable data."
      Verification: "Check the service for explicit Zod parsing of the LLM's JSON response."
  Rationale: "Zero-trust model applied to external AI services: never trust the output, always validate."
  Prerequisites: ["062", "032"]

- ID: "064"
  Title: "Implement PlannerService - Initial 'determineNextAction' Logic"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "planner"
      - "core-logic"
      - "orchestration"
  Description: "Implement the initial planning logic in `PlannerService.determineNextAction()`, focusing on a simple, predefined action for the first run (e.g., 'Update README.md with project version')."
  Implementation_Details:
    Action: "In 'apps/api/src/agent/planner/planner.service.ts', implement a method that returns a hardcoded `PatchRequestDTO` array for a non-critical file (e.g., a documentation file). This setup mocks the 'planning' stage and acts as a safe initial test case."
    Expected_Artifacts:
      - File: "apps/api/src/agent/planner/planner.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Add a unit test to verify the Planner service returns the expected, correctly-formed `PatchRequestDTO`."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Safe Initial State"
      Description: "Ensures the first autonomous action is non-critical and fully predictable, allowing the human governance team to easily verify the entire upgrade loop before complex planning is implemented."
      Verification: "Check the service for the hardcoded output structure."
  Rationale: "MVP implementation for the planning stage, ensuring the execution pipeline has valid input data."
  Prerequisites: ["047", "031"]

- ID: "065"
  Title: "Implement ExecutorService - Pre-Execution Path Verification Guard"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "executor"
      - "security"
      - "path-check"
  Description: "In `ExecutorService`, implement a pre-execution safety gate that verifies every file path in the `UpgradeProposalDTO` array against the `PROTECTED_PATHS` list."
  Implementation_Details:
    Action: "In 'apps/api/src/agent/executor/executor.service.ts', before any Git/file operation, iterate over all `UpgradeProposalDTO` objects. If any `filePath` matches a string in `PROTECTED_PATHS` (e.g., '.env', CI YAMLs), log a critical security event and throw an exception, immediately halting execution."
    Expected_Artifacts:
      - File: "apps/api/src/agent/executor/executor.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Add a unit test to `ExecutorService` that simulates an `UpgradeProposalDTO` attempting to modify a protected file (e.g., 'SECURITY.md') and asserts that the service correctly throws a security exception."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Protected Path Execution Guard (L2)"
      Description: "A mandatory, critical safety mechanism preventing the agent from autonomously editing its own security and governance policy files, ensuring human oversight remains in control."
      Verification: "Check the service for explicit logic comparing proposed paths against the `PROTECTED_PATHS` array."
  Rationale: "The core safety barrier for the autonomous agent. This must be the first check in the execution layer."
  Prerequisites: ["048", "046", "063"]

- ID: "066"
  Title: "Implement ExecutorService - Secure File Write and Git Staging"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "executor"
      - "git"
      - "file-system"
  Description: "Implement the file writing and Git staging logic in `ExecutorService.executeUpgrade()` using the secure `GitClientService` methods."
  Implementation_Details:
    Action: "In `ExecutorService`, iterate over the validated `UpgradeProposalDTO`s. For each proposal, call `GitClientService.writeFile()` (from 061) with the proposed content, and then call `GitClientService.gitStageFile(path)` (a new method to be created in GitClientService) to stage the change."
    Expected_Artifacts:
      - File: "apps/api/src/agent/executor/executor.service.ts"
        State: "modified"
      - File: "apps/api/src/git/git-client.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Integration_Test"
      Description: "Simulate a run where the ExecutorService successfully stages a proposed file modification. Verify that `git status` (mocked) shows the file is staged."
      Command: "pnpm test:integration --filter api"
  Security_Controls:
    - Control: "Execution Isolation (Git Staging)"
      Description: "Ensures the agent's execution is done only via the secure, validated methods of the GitClientService, preventing direct command execution."
      Verification: "Check ExecutorService for exclusive use of `GitClientService` for all file/git interactions."
  Rationale: "This implements the core action of the autonomous agent, ensuring it adheres to the secure Git client abstraction."
  Prerequisites: ["065", "061"]

- ID: "067"
  Title: "Implement ExecutorService - Unit Test and Rollback Mechanism Skeleton"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "executor"
      - "testing"
      - "rollback"
  Description: "Add a step to the `ExecutorService` to run local tests *after* applying the patch, and implement a rollback mechanism (using Git) if tests fail."
  Implementation_Details:
    Action: "In `ExecutorService.executeUpgrade()`, after staging changes, execute `GitClientService.runTests(command: 'pnpm test --no-coverage')`. If the command fails, execute `GitClientService.gitRollback()` (a new method to be created in GitClientService to perform `git reset --hard HEAD`). Log the rollback."
    Expected_Artifacts:
      - File: "apps/api/src/agent/executor/executor.service.ts"
        State: "modified"
      - File: "apps/api/src/git/git-client.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Integration_Test"
      Description: "Simulate a test failure after staging. Verify the ExecutorService logs the failure and executes the rollback command (mocked)."
      Command: "pnpm test:integration --filter api"
  Security_Controls:
    - Control: "Automated Rollback (Safety Gate)"
      Description: "Mandatory stability control. Prevents the agent from creating a broken or unstable state by automatically reverting changes that fail self-validation tests."
      Verification: "Check the ExecutorService for conditional rollback logic based on test results."
  Rationale: "Core of the self-upgrading reliability. An autonomous agent must be able to heal itself if its changes introduce bugs."
  Prerequisites: ["066"]

- ID: "068"
  Title: "Implement AgentService - Full Orchestration Loop"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Large"
    Tags:
      - "orchestration"
      - "core-logic"
      - "logging"
  Description: "Implement the complete, sequential orchestration loop in `AgentService.runAutonomousUpgrade()`, calling the Planner, LLM, and Executor services in sequence."
  Implementation_Details:
    Action: "In 'apps/api/src/agent/agent.service.ts', implement the full sequence: 1. Call `PlannerService.determineNextAction()`. 2. Iterate and call `LLMService.generatePatch()` for each action. 3. Call `ExecutorService.executeUpgrade(proposals)`. Add comprehensive structured logging around each step (start, success, failure) for full auditability."
    Expected_Artifacts:
      - File: "apps/api/src/agent/agent.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Integration_Test"
      Description: "Create a top-level integration test that mocks *only* the LLM response and verifies the full pipeline runs successfully, resulting in a staged file change (mocked)."
      Command: "pnpm test:e2e --filter api"
  Security_Controls:
    - Control: "Centralized Audit Trail"
      Description: "The orchestrator is the point where the agent's security log is finalized, providing an end-to-end record of the autonomous operation for human governance."
      Verification: "Check the service for structured logging at every step and boundary."
  Rationale: "Finalizes the core functional flow, ensuring all security gates are executed in the correct sequence."
  Prerequisites: ["067", "063", "064"]

- ID: "069"
  Title: "Implement GitClient Service - Secure Branch Creation and Commit"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "git"
      - "security"
      - "branching"
  Description: "Implement `GitClientService` methods for creating a new branch and committing the staged changes with an auditable commit message."
  Implementation_Details:
    Action: "In `GitClientService.ts`, implement `gitCreateBranch(name)` and `gitCommit(message)`. Enforce a strict commit message format (e.g., '[AUTONOMOUS]: <type>(scope): <description>') to clearly mark agent-generated commits for governance and auditing."
    Expected_Artifacts:
      - File: "apps/api/src/git/git-client.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Add unit tests to verify the branch creation and commit commands are correctly executed (mocked) and the commit message conforms to the required format."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Auditable Commit History"
      Description: "Ensures all autonomous changes are clearly distinguishable in the Git history, simplifying the human reviewer's job and preventing the agent from cloaking its changes."
      Verification: "Check the commit method for commit message formatting enforcement."
  Rationale: "Governance requirement: clear separation of human and autonomous contributions in the repository."
  Prerequisites: ["068"]

- ID: "070"
  Title: "Implement GitHubService - Create Pull Request Functionality"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "github"
      - "octokit"
      - "pr"
  Description: "Implement the final action in `GitHubService`: `createPullRequest(branchName, title, body)` using Octokit to propose the agent's changes."
  Implementation_Details:
    Action: "In 'apps/api/src/github/github.service.ts', implement `createPullRequest` using `octokit.rest.pulls.create()`. Ensure the PR is always created against the 'main' branch, enforcing the human-in-the-loop governance model."
    Expected_Artifacts:
      - File: "apps/api/src/github/github.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Write a unit test that mocks the Octokit response and verifies the PR creation call is correctly structured (base: 'main', head: agent branch, required title/body)."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "PR-Only Governance Enforcement"
      Description: "This method is the final gateway, ensuring the agent's changes are *only* proposed via a Pull Request, never directly merged, forcing the human approval gate."
      Verification: "Check the method to ensure `base` is strictly set to 'main' or the protected branch."
  Rationale: "The technical implementation of the 'Human-in-the-Loop' policy."
  Prerequisites: ["069", "054", "055"]

- ID: "071"
  Title: "Finalize ExecutorService - Commit and PR Creation"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "executor"
      - "git"
      - "github"
  Description: "Finalize `ExecutorService.executeUpgrade()` by calling the Git commit and GitHub PR creation functions after successful test execution and before exiting."
  Implementation_Details:
    Action: "In `ExecutorService.executeUpgrade()`: after tests pass (067), call `GitClientService.gitCommit()` (069) and then `GitHubService.createPullRequest()` (070). Log the final PR URL for human governance review."
    Expected_Artifacts:
      - File: "apps/api/src/agent/executor/executor.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Integration_Test"
      Description: "Create an integration test that runs the entire AgentService flow (mocks LLM) and verifies that the `gitCommit` and `createPullRequest` methods (mocked) are called exactly once."
      Command: "pnpm test:integration --filter api"
  Security_Controls:
    - Control: "Secure Execution Finalization"
      Description: "Ensures the agent completes its operation in an atomic, auditable manner, creating a verifiable record (the PR) for human review."
      Verification: "Check the service for the final sequential calls to the Git and GitHub services."
  Rationale: "Completes the autonomous loop: Plan -> Generate -> Test -> Execute (Commit/PR)."
  Prerequisites: ["070", "069", "068"]

- ID: "072"
  Title: "Implement API Controller - Security Authorization Guard Skeleton"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "security"
      - "authorization"
      - "nest-js"
  Description: "Scaffold a basic NestJS Guard to enforce a secret token check on the `/run-agent` endpoint, restricting execution only to the CI/CD pipeline."
  Implementation_Details:
    Action: "Create 'apps/api/src/common/guards/secret-token.guard.ts'. Implement a guard that checks for a matching header (e.g., `X-Agent-Secret-Key`) against a securely loaded environment variable. Apply this guard globally or to the `AgentController`."
    Expected_Artifacts:
      - File: "apps/api/src/common/guards/secret-token.guard.ts"
        State: "created"
      - File: "apps/api/src/agent/agent.controller.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify a request without the correct secret key header fails with a 403 Forbidden error."
      Instructions: "Run the app and send a request to `/run-agent` without the header, then with the correct header."
  Security_Controls:
    - Control: "Access Restriction (Authorization)"
      Description: "Enforces a mandatory authorization check, ensuring the agent's core function is only triggered by the trusted CI/CD environment (or a human with the secret key)."
      Verification: "Check `agent.controller.ts` for the `@UseGuards()` decorator."
  Rationale: "Prevents unauthorized external parties from triggering the autonomous code modification loop."
  Prerequisites: ["042", "041"]

- ID: "073"
  Title: "Implement API Controller - Request Rate Limiting"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "security"
      - "rate-limiting"
      - "governance"
  Description: "Integrate NestJS rate limiting to prevent abuse or denial-of-service against the `/run-agent` endpoint."
  Implementation_Details:
    Action: "Install `@nestjs/throttler`. Configure the ThrottlerModule in `AppModule` using the security constants defined in Prompt 052 for rate limits (e.g., 10 requests per minute). Apply the `ThrottlerGuard` globally."
    Expected_Artifacts:
      - File: "apps/api/src/app.module.ts"
        State: "modified"
      - File: "package.json"
        State: "modified"
    Dependencies:
      - Name: "@nestjs/throttler"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the endpoint returns a 429 Too Many Requests error after exceeding the configured limit."
      Instructions: "Send 11 requests in 30 seconds to the `/run-agent` endpoint."
  Security_Controls:
    - Control: "Denial-of-Service Mitigation (Rate Limiting)"
      Description: "Protects the autonomous agent's trigger endpoint from resource exhaustion attacks."
      Verification: "Check `app.module.ts` for correct ThrottlerModule configuration using the security constants."
  Rationale: "Standard security practice for public-facing APIs, even if internal, to ensure operational stability."
  Prerequisites: ["072", "052"]

- ID: "074"
  Title: "Implement Global Security Headers Interceptor"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "security"
      - "headers"
      - "owasp"
  Description: "Create a NestJS Interceptor to automatically add critical security headers (HSTS, CSP, X-Frame-Options) to all API responses, mitigating OWASP Top 10 risks."
  Implementation_Details:
    Action: "Create 'apps/api/src/common/interceptors/security-headers.interceptor.ts'. Implement a header setting logic using the constants from Prompt 052. Apply this interceptor globally in `main.ts`."
    Expected_Artifacts:
      - File: "apps/api/src/common/interceptors/security-headers.interceptor.ts"
        State: "created"
      - File: "apps/api/src/main.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify all responses include the mandatory security headers (e.g., HSTS)."
      Instructions: "Send a request to any endpoint and inspect the response headers using a browser or curl."
  Security_Controls:
    - Control: "OWASP Top 10 Mitigation (Security Headers)"
      Description: "Guards against common web-based vulnerabilities like clickjacking (X-Frame-Options), Cross-Site Scripting (CSP), and protocol downgrade attacks (HSTS)."
      Verification: "Check the interceptor logic for all mandatory headers defined in the constants."
  Rationale: "Proactive, multi-layered defense is required, even for an internal API."
  Prerequisites: ["073", "052"]

- ID: "075"
  Title: "Implement PlannerService - Full File Scanning for Potential Upgrades"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "planner"
      - "file-system"
      - "core-logic"
  Description: "Enhance `PlannerService` to recursively scan the `MODIFIABLE_PATHS` directories for files and gather their content, providing the LLM with the current code context."
  Implementation_Details:
    Action: "In `PlannerService`, implement a utility method to recursively find files within `MODIFIABLE_PATHS` (using `path` and `fs` modules). Modify `determineNextAction()` to read the file content of all found files using `GitClientService.readFile()` and generate a `PatchRequestDTO` for each, including its content."
    Expected_Artifacts:
      - File: "apps/api/src/agent/planner/planner.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Integration_Test"
      Description: "Verify the PlannerService correctly identifies and reads the content of a test file inside 'apps/api/src', while ignoring files outside the allowed path."
      Command: "pnpm test:integration --filter api"
  Security_Controls:
    - Control: "Limited File Access Scope"
      Description: "Ensures the agent's planning phase is confined only to the explicitly allowed and modifiable source code directories, preventing unauthorized data exfiltration or planning on governance files."
      Verification: "Check the recursive scan logic for explicit filtering by `MODIFIABLE_PATHS`."
  Rationale: "The agent's perception is its reality. Limiting its perception to safe areas is a key security measure."
  Prerequisites: ["064", "061"]

- ID: "076"
  Title: "Implement PlannerService - LLM Prompt Engineering for Self-Referential Planning"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "planner"
      - "llm"
      - "prompt-engineering"
  Description: "Refine the LLM prompt used in the `PlannerService` to guide the LLM to perform specific, useful, and safe tasks, using the gathered code context."
  Implementation_Details:
    Action: "Modify the `PlannerService` to construct a detailed system prompt that includes: 1. The agent's mission (self-upgrade/refactor). 2. Security constraints (only modify files in `MODIFIABLE_PATHS`). 3. The current file contents (`current_content`). 4. The required JSON output format (`UpgradeProposalDTO`)."
    Expected_Artifacts:
      - File: "apps/api/src/agent/planner/planner.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Verify the generated LLM prompt contains all the mandatory security and format constraints."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Prompt-based Security Steering"
      Description: "Uses the system prompt as a soft security layer, guiding the LLM's output toward safety and adherence to the defined architecture before the hard, runtime checks occur."
      Verification: "Check the prompt construction for clear, explicit security instructions."
  Rationale: "Leverages the meta-engineering layer (Copilot/LLM) to enforce security through instruction, reducing reliance solely on code guards."
  Prerequisites: ["075", "062"]

- ID: "077"
  Title: "Create Shared Package for Agent-Specific Exceptions"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Shared Packages"
    Size: "Small"
    Tags:
      - "exceptions"
      - "security"
      - "error-handling"
  Description: "Create a shared package (`@aca/exceptions`) for standardized, structured application exceptions (e.g., `ProtectedPathModificationError`, `RollbackFailedError`)."
  Implementation_Details:
    Action: "Create the directory 'packages/exceptions'. Initialize it, and define a base `AgentException` class and a specific `ProtectedPathModificationError`. Ensure these errors are exported and logged correctly when caught by the exception filter."
    Expected_Artifacts:
      - File: "packages/exceptions/src/protected-path-modification.error.ts"
        State: "created"
      - File: "packages/exceptions/package.json"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the `ExecutorService` can import and throw the new `ProtectedPathModificationError`."
      Instructions: "Modify the ExecutorService test (065) to throw the new structured error."
  Security_Controls:
    - Control: "Structured Error Auditing"
      Description: "Standardized exceptions provide clear, machine-readable failure points in the audit logs, especially for critical security breaches like protected path modification attempts."
      Verification: "Check the exception class for necessary fields (e.g., path, user, timestamp)."
  Rationale: "Professional error handling enhances auditability and maintenance."
  Prerequisites: ["056", "020"]

- ID: "078"
  Title: "Refactor ExecutorService to Use Structured Exceptions"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Small"
    Tags:
      - "exceptions"
      - "security"
      - "error-handling"
  Description: "Refactor the security logic in `ExecutorService` (Prompt 065) to throw the newly defined `ProtectedPathModificationError` instead of a generic exception."
  Implementation_Details:
    Action: "In 'apps/api/src/agent/executor/executor.service.ts', update the protected path check (065) to import and throw the specific `ProtectedPathModificationError` from the shared exceptions package."
    Expected_Artifacts:
      - File: "apps/api/src/agent/executor/executor.service.ts"
        State: "modified"
    Dependencies:
      - Name: "@aca/exceptions"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Run the unit test for protected path modification (065) and verify it now correctly catches the new structured error type."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Explicit Security Violation Reporting"
      Description: "Clear, specific error types ensure that the human governance team's monitoring system can immediately and accurately flag a critical security violation."
      Verification: "Check the code for the explicit `throw new ProtectedPathModificationError(...)`."
  Rationale: "Clean, auditable error handling for security events."
  Prerequisites: ["077", "065"]

- ID: "079"
  Title: "Implement Frontend (Client) Placeholder for Agent Status"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Frontend (Client Application)"
    Size: "Medium"
    Tags:
      - "ui-placeholder"
      - "next-js"
      - "status"
  Description: "Scaffold a basic Next.js application structure in `apps/web` to serve as the human governance dashboard placeholder, showing agent status and latest PR link."
  Implementation_Details:
    Action: "Create the directory 'apps/web'. Initialize a minimal Next.js application (via pnpm create next-app) using TypeScript. Create an 'index.tsx' page that displays the agent's current version (read from VERSION.txt) and a placeholder for the 'Last Autonomous PR' link."
    Expected_Artifacts:
      - File: "apps/web/package.json"
        State: "created"
      - File: "apps/web/pages/index.tsx"
        State: "created"
      - File: "apps/web/tsconfig.json"
        State: "created"
    Dependencies:
      - Name: "next"
        Version: "latest"
        Type: "prod"
      - Name: "react"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the web application builds and runs locally."
      Command: "pnpm run --filter web dev"
  Security_Controls:
    - Control: "Status Visibility (Audit Trail)"
      Description: "Provides a user-friendly interface for the human governance authority to quickly check the agent's last action, ensuring transparency and accountability."
      Verification: "Check the UI for the displayed version number."
  Rationale: "Although the core is the agent, a minimal frontend is necessary to fulfill the human governance oversight requirement."
  Prerequisites: ["009", "016"]

- ID: "080"
  Title: "Configure Shared Config for Frontend TSConfig"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Shared Packages"
    Size: "Small"
    Tags:
      - "typescript"
      - "monorepo"
      - "config"
  Description: "Configure the `apps/web` Next.js application to extend the strict shared TypeScript configuration (`packages/config/tsconfig.base.json`)."
  Implementation_Details:
    Action: "Modify 'apps/web/tsconfig.json' to extend `../../packages/config/tsconfig.base.json`. Ensure Next.js-specific compiler options (e.g., `jsx`) are added, but the strictness from the base is preserved."
    Expected_Artifacts:
      - File: "apps/web/tsconfig.json"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Syntax"
      Description: "Verify the web application compiles successfully with the inherited strict rules."
      Command: "pnpm run --filter web build"
  Security_Controls:
    - Control: "Configuration Standardization"
      Description: "Ensures the human governance interface adheres to the same code quality and security standards as the autonomous agent itself."
      Verification: "Check the 'extends' field in 'apps/web/tsconfig.json'."
  Rationale: "Maintains code quality and consistency across the monorepo."
  Prerequisites: ["079", "015"]

- ID: "081"
  Title: "Initial Draft of Agent Status API Endpoint"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "api"
      - "status"
      - "read-only"
  Description: "Create a separate, read-only endpoint in the NestJS API to expose the agent's current status (version, health, last PR details) for the frontend dashboard."
  Implementation_Details:
    Action: "In 'apps/api/src/system/system.controller.ts', create a read-only GET endpoint `/api/v1/status`. This endpoint should inject the `SystemService` to retrieve the current version and a placeholder status object."
    Expected_Artifacts:
      - File: "apps/api/src/system/system.controller.ts"
        State: "created"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the status endpoint is publicly accessible (no security guard) and returns a JSON payload."
      Instructions: "Send a GET request to the `/api/v1/status` endpoint."
  Security_Controls:
    - Control: "Access Control Isolation"
      Description: "The status endpoint is read-only and unprivileged, ensuring it does not require the secret key, maintaining a clear separation from the highly restricted `/run-agent` execution endpoint."
      Verification: "Ensure the controller does NOT have the `@UseGuards(SecretTokenGuard)` decorator."
  Rationale: "Separation of concerns and privileges. Status should be easily viewable, while execution must be highly restricted."
  Prerequisites: ["021", "072"]

- ID: "082"
  Title: "Implement API Controller - Set Content Security Policy (CSP)"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Medium"
    Tags:
      - "security"
      - "csp"
      - "owasp"
  Description: "Enhance the security headers interceptor (074) to include a robust Content Security Policy (CSP) header, explicitly allowing only necessary content sources."
  Implementation_Details:
    Action: "Modify 'apps/api/src/common/interceptors/security-headers.interceptor.ts'. Add a strict CSP header value to the response. Since the API is not serving UI, the policy should be focused on preventing external script/object loading (e.g., `default-src 'self'`)."
    Expected_Artifacts:
      - File: "apps/api/src/common/interceptors/security-headers.interceptor.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the response includes the Content-Security-Policy header."
      Instructions: "Inspect the response headers for the presence and value of the CSP."
  Security_Controls:
    - Control: "Defense-in-Depth (CSP)"
      Description: "Mitigates injection attacks (like XSS) if an attacker somehow gains control of the API response body, even if the primary purpose is not serving HTML."
      Verification: "Check the interceptor for the detailed CSP string."
  Rationale: "Defense-in-depth principle. Security headers must be robustly configured on all HTTP services."
  Prerequisites: ["074"]

- ID: "083"
  Title: "Initial E2E Test Setup (Playwright/Cypress Placeholder)"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Validation Setup"
    Size: "Medium"
    Tags:
      - "e2e"
      - "testing"
      - "validation"
  Description: "Install an E2E testing framework (e.g., Playwright) and create a basic smoke test configuration."
  Implementation_Details:
    Action: "Install Playwright as a dev dependency and initialize its configuration (`playwright.config.ts`). Create a minimal test suite `tests/e2e/smoke.spec.ts` that hits the unprivileged `/api/v1/status` endpoint and asserts a 200 OK response."
    Expected_Artifacts:
      - File: "playwright.config.ts"
        State: "created"
      - File: "tests/e2e/smoke.spec.ts"
        State: "created"
      - File: "package.json"
        State: "modified"
    Dependencies:
      - Name: "@playwright/test"
        Version: "latest"
        Type: "dev"
  Validation_Criteria:
    - Type: "End-to-End (E2E) Tests"
      Description: "Verify the E2E test runs successfully against the running API."
      Command: "pnpm e2e"
  Security_Controls:
    - Control: "External Application Posture Test"
      Description: "Verifies the external API boundaries (including security headers and CORS policy) are correctly configured from an external attacker's perspective."
      Verification: "Check the E2E test for assertion on the 200 status code."
  Rationale: "E2E tests are required to validate the system's operational readiness and security configuration from the outside."
  Prerequisites: ["081"]

- ID: "084"
  Title: "Implement GitClient Service - Secure Branch Delete Operation"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Small"
    Tags:
      - "git"
      - "cleanup"
      - "security"
  Description: "Implement a secure method in `GitClientService` to delete the local branch after the Pull Request has been successfully created."
  Implementation_Details:
    Action: "In `GitClientService.ts`, implement `gitDeleteLocalBranch(name, force: boolean)`. Ensure the force option is used judiciously and the operation is logged. Use an array of arguments to the `child_process` execution to mitigate shell injection risks."
    Expected_Artifacts:
      - File: "apps/api/src/git/git-client.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Add a unit test to verify the `git branch -D` command is correctly formulated and executed (mocked)."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Secure Cleanup and Ephemeral Environment"
      Description: "Ensures the agent maintains a clean working environment and deletes ephemeral branches, reducing confusion and preventing accidental use of stale branches."
      Verification: "Check the method for secure argument passing to the command line."
  Rationale: "Good operational hygiene is essential for an autonomous system."
  Prerequisites: ["071", "069"]

- ID: "085"
  Title: "Finalize ExecutorService - Local Branch Cleanup"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Small"
    Tags:
      - "executor"
      - "cleanup"
      - "git"
  Description: "Update `ExecutorService` to call `GitClientService.gitDeleteLocalBranch()` after the Pull Request is successfully created."
  Implementation_Details:
    Action: "In `ExecutorService.executeUpgrade()`, after receiving the PR URL from `GitHubService.createPullRequest()`, call `GitClientService.gitDeleteLocalBranch()` to clean up the local feature branch."
    Expected_Artifacts:
      - File: "apps/api/src/agent/executor/executor.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Integration_Test"
      Description: "Verify the cleanup method (mocked) is the final step called by the ExecutorService."
      Command: "pnpm test:integration --filter api"
  Security_Controls:
    - Control: "Execution Atomicity"
      Description: "Ensures the agent's run is atomicâ€”either it fails with a rollback or succeeds with a committed, PR-proposed change and a clean local state."
      Verification: "Check the end of the `executeUpgrade` method."
  Rationale: "Ensures the Codespaces sandbox is reset to a clean state after each autonomous run."
  Prerequisites: ["084", "071"]

- ID: "086"
  Title: "Initial Draft of Shared UI Components Package (packages/ui)"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Shared Packages"
    Size: "Medium"
    Tags:
      - "ui"
      - "monorepo"
      - "design-system"
  Description: "Scaffold a shared components library package (`@aca/ui`) to house reusable UI elements for the governance dashboard."
  Implementation_Details:
    Action: "Create the directory 'packages/ui'. Initialize it with `package.json`, `tsconfig.json`, and a basic 'Button' component using plain React and TypeScript. Configure the package to be consumable by the Next.js app."
    Expected_Artifacts:
      - File: "packages/ui/src/components/Button.tsx"
        State: "created"
      - File: "packages/ui/package.json"
        State: "created"
    Dependencies:
      - Name: "react"
        Version: "latest"
        Type: "peer"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the `apps/web` application can import and render the `Button` component."
      Instructions: "Modify `apps/web/pages/index.tsx` to use the new Button component."
  Security_Controls:
    - Control: "Component Standardization"
      Description: "Centralizes UI elements, ensuring consistent security and accessibility (A11Y) features are built into reusable components."
      Verification: "Check `apps/web/package.json` for the local dependency on `@aca/ui`."
  Rationale: "DRY principle for the governance dashboard, essential for future scalability."
  Prerequisites: ["079"]

- ID: "087"
  Title: "Implement SystemService - Get Current Git Commit Hash"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Small"
    Tags:
      - "system-status"
      - "git"
      - "observability"
  Description: "Enhance `SystemService` to retrieve the current Git commit hash, providing an exact, auditable version ID for the running agent instance."
  Implementation_Details:
    Action: "In 'apps/api/src/system/system.service.ts', implement a method `getCommitHash()` that uses `child_process.execSync` (or an injected GitClientService method) to run `git rev-parse HEAD`."
    Expected_Artifacts:
      - File: "apps/api/src/system/system.service.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Unit_Test"
      Description: "Add a test to verify the service correctly parses a mock commit hash."
      Command: "pnpm test --filter api"
  Security_Controls:
    - Control: "Auditable System Identity"
      Description: "Provides an immutable identifier for the running agent, enabling human governance to quickly match a deployed instance to the exact code in the repository."
      Verification: "Check the service for the command execution and output parsing."
  Rationale: "Essential for linking operational logs and security events to the precise source code version."
  Prerequisites: ["081", "069"]

- ID: "088"
  Title: "Update Status API Endpoint to Include Commit Hash"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Backend (API Services)"
    Size: "Small"
    Tags:
      - "api"
      - "status"
      - "observability"
  Description: "Update the `/api/v1/status` endpoint to include the Git commit hash, version number, and current uptime."
  Implementation_Details:
    Action: "Modify 'apps/api/src/system/system.controller.ts' and 'system.service.ts'. The service should return a structured status object containing `version`, `commitHash`, and `uptime` (using Node's `process.uptime()`)."
    Expected_Artifacts:
      - File: "apps/api/src/system/system.service.ts"
        State: "modified"
      - File: "apps/api/src/system/system.controller.ts"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the status endpoint payload contains the three new fields with non-empty values."
      Instructions: "GET the `/api/v1/status` endpoint and check the JSON response."
  Security_Controls:
    - Control: "Operational Transparency"
      Description: "Provides the human governance team with immediate, verifiable data on the agent's operational health and code lineage."
      Verification: "Check the controller's response schema."
  Rationale: "Enhances the governance dashboard's ability to monitor the agent."
  Prerequisites: ["087", "081"]

- ID: "089"
  Title: "Refactor Frontend Dashboard to Display Agent Status"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Frontend (Client Application)"
    Size: "Medium"
    Tags:
      - "ui-placeholder"
      - "next-js"
      - "governance"
  Description: "Update the `apps/web` dashboard to fetch and display the full agent status from the `/api/v1/status` endpoint."
  Implementation_Details:
    Action: "Modify `apps/web/pages/index.tsx`. Implement `getServerSideProps` or `useEffect` to fetch the status from the API. Display the `version`, `commitHash`, and `uptime` on the page. Add clear visual markers (e.g., status OK/Error)."
    Expected_Artifacts:
      - File: "apps/web/pages/index.tsx"
        State: "modified"
    Dependencies:
      - Name: "axios"
        Version: "latest"
        Type: "prod"
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the web page loads and displays the status information correctly from the API."
      Instructions: "Run the full stack locally and open the web page. The data must be visible."
  Security_Controls:
    - Control: "Human Governance Interface"
      Description: "The visual interface for human oversight is implemented, fulfilling the 'human-in-the-loop' visibility requirement."
      Verification: "Check the UI for correct data display."
  Rationale: "Closes the loop between the autonomous agent and the human governance authority."
  Prerequisites: ["088", "079"]

- ID: "090"
  Title: "Implement Environment Configuration for Frontend API URL"
  Metadata:
    Phase: "Secure Implementation"
    Stage: "Frontend (Client Application)"
    Size: "Small"
    Tags:
      - "config"
      - "frontend"
      - "security"
  Description: "Configure the Next.js application to securely load the backend API URL via environment variables."
  Implementation_Details:
    Action: "In `apps/web/.env.local` and `apps/web/.env.example`, define `NEXT_PUBLIC_API_URL` and use it in `apps/web/pages/index.tsx` for the API fetch call. Ensure the environment variable is prefixed `NEXT_PUBLIC_` for client-side exposure."
    Expected_Artifacts:
      - File: "apps/web/.env.local"
        State: "created"
      - File: "apps/web/.env.example"
        State: "created"
      - File: "apps/web/pages/index.tsx"
        State: "modified"
    Dependencies: []
  Validation_Criteria:
    - Type: "Functional_Check"
      Description: "Verify the web application reads the API URL correctly from the environment variable."
      Instructions: "Change the variable and verify the fetch call uses the new URL."
  Security_Controls:
    - Control: "Configuration Separation"
      Description: "Prevents hardcoding of production API URLs, reducing deployment errors and ensuring environment-specific configurations."
      Verification: "Check the code for correct environment variable usage."
  Rationale: "Standard practice for environment-aware frontends."
  Prerequisites: ["089"]]
```
</details>

---

> For implementation, copy the relevant prompt from this file into your planning or development workflow.
